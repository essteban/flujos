parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"dGdR":[function(require,module,exports) {
"use strict";var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function r(e){console&&console.warn&&console.warn(e)}e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}module.exports=o,module.exports.once=m,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function f(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var o,s,c;if(u(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),c=s[t]),void 0===c)c=s[t]=n,++e._eventsCount;else if("function"==typeof c?c=s[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(o=f(e))>0&&c.length>o&&!c.warned){c.warned=!0;var v=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");v.name="MaxListenersExceededWarning",v.emitter=e,v.type=t,v.count=c.length,r(v)}return e}function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=v.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?d(i):h(i,i.length)}function a(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function d(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function m(e,t){return new Promise(function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&L(e,i,{once:!0})})}function L(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)})}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return f(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var f=o[e];if(void 0===f)return!1;if("function"==typeof f)n(f,this,t);else{var c=f.length,v=h(f,c);for(r=0;r<c;++r)n(v[r],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return u(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():y(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):a.call(e,t)},o.prototype.listenerCount=a,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};
},{}],"JSid":[function(require,module,exports) {
var define;
var e;!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof e&&e.amd?e([],r):"object"==typeof exports?exports.bowser=r():t.bowser=r()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),s=e.getVersionPrecision(r),o=Math.max(i,s),a=0,u=e.map([t,r],function(t){var r=o-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(n&&(a=o-Math.min(i,s)),o-=1;o>=a;){if(u[0][o]>u[1][o])return 1;if(u[0][o]===u[1][o]){if(o===a)return 0;o-=1}else if(u[0][o]<u[1][o])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var a=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach(function(t){n[t]=e[t]})};for(t=0,r=s.length;t<r;t+=1)a();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},s=r(18);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){}var t,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],null&&o(t.prototype,null),r&&o(t,r),e}();t.default=a,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=u(r(92)),i=u(r(93)),s=u(r(94)),o=u(r(95)),a=u(r(17));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(n.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(i.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(s.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(o.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},s=0;if(Object.keys(e).forEach(function(t){var o=e[t];"string"==typeof o?(i[t]=o,s+=1):"object"==typeof o&&(r[t]=o,n+=1)}),n>0){var o=Object.keys(r),u=a.default.find(o,function(e){return t.isOS(e)});if(u){var d=this.satisfies(r[u]);if(void 0!==d)return d}var c=a.default.find(o,function(e){return t.isPlatform(e)});if(c){var f=this.satisfies(r[c]);if(void 0!==f)return f}}if(s>0){var l=Object.keys(i),h=a.default.find(l,function(e){return t.isBrowser(e,!0)});if(void 0!==h)return this.compareVersion(i[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=a.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(a.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some(function(e){return t.is(e)})},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},r=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:s.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:s.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=o,e.exports=t.default}})});
},{}],"LVkZ":[function(require,module,exports) {
var s=1e3,e=60*s,r=60*e,a=24*r,n=7*a,c=365.25*a;function t(t){if(!((t=String(t)).length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(u){var i=parseFloat(u[1]);switch((u[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return i*c;case"weeks":case"week":case"w":return i*n;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*e;case"seconds":case"second":case"secs":case"sec":case"s":return i*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}function u(n){var c=Math.abs(n);return c>=a?Math.round(n/a)+"d":c>=r?Math.round(n/r)+"h":c>=e?Math.round(n/e)+"m":c>=s?Math.round(n/s)+"s":n+"ms"}function i(n){var c=Math.abs(n);return c>=a?o(n,c,a,"day"):c>=r?o(n,c,r,"hour"):c>=e?o(n,c,e,"minute"):c>=s?o(n,c,s,"second"):n+" ms"}function o(s,e,r,a){var n=e>=1.5*r;return Math.round(s/r)+" "+a+(n?"s":"")}module.exports=function(s,e){e=e||{};var r=typeof s;if("string"===r&&s.length>0)return t(s);if("number"===r&&isFinite(s))return e.long?i(s):u(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};
},{}],"MTTc":[function(require,module,exports) {
function e(e){function n(e){let r,o=null;function s(...e){if(!s.enabled)return;const t=s,o=Number(new Date),l=o-(r||o);t.diff=l,t.prev=r,t.curr=o,r=o,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return"%";i++;const s=n.formatters[o];if("function"==typeof s){const n=e[i];r=s.call(t,n),e.splice(i,1),i--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return s.namespace=e,s.useColors=n.useColors(),s.color=n.selectColor(e),s.extend=t,s.destroy=n.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null===o?n.enabled(e):o,set:e=>{o=e}}),"function"==typeof n.init&&n.init(s),s}function t(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(r),...n.skips.map(r).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=require("ms"),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(t=>{n[t]=e[t]}),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]},n.enable(n.load()),n}module.exports=e;
},{"ms":"LVkZ"}],"dJPe":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"jD9Y":[function(require,module,exports) {
var process = require("process");
var e=require("process");function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function t(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),!this.useColors)return;const o="color: "+this.color;e.splice(1,0,o,"color: inherit");let t=0,C=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(t++,"%c"===e&&(C=t))}),e.splice(C,0,o)}function C(e){try{e?exports.storage.setItem("debug",e):exports.storage.removeItem("debug")}catch(o){}}function r(){let o;try{o=exports.storage.getItem("debug")}catch(t){}return!o&&void 0!==e&&"env"in e&&(o=void 0),o}function n(){try{return localStorage}catch(e){}}exports.formatArgs=t,exports.save=C,exports.load=r,exports.useColors=o,exports.storage=n(),exports.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.log=console.debug||console.log||(()=>{}),module.exports=require("./common")(exports);const{formatters:s}=module.exports;s.j=function(e){try{return JSON.stringify(e)}catch(o){return"[UnexpectedJSONParseError]: "+o.message}};
},{"./common":"MTTc","process":"dJPe"}],"andi":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;const r=e(require("debug")),t="mediasoup-client";class o{constructor(e){e?(this._debug=r.default(`${t}:${e}`),this._warn=r.default(`${t}:WARN:${e}`),this._error=r.default(`${t}:ERROR:${e}`)):(this._debug=r.default(t),this._warn=r.default(`${t}:WARN`),this._error=r.default(`${t}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}exports.Logger=o;
},{"debug":"jD9Y"}],"P3Oo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EnhancedEventEmitter=void 0;const e=require("events"),t=require("./Logger"),r=new t.Logger("EnhancedEventEmitter");class s extends e.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const s=this.listenerCount(e);try{return this.emit(e,...t)}catch(n){return r.error("safeEmit() | event listener threw an error [event:%s]:%o",e,n),Boolean(s)}}async safeEmitAsPromise(e,...t){return new Promise((s,n)=>{try{this.emit(e,...t,s,n)}catch(i){r.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,i),n(i)}})}}exports.EnhancedEventEmitter=s;
},{"events":"dGdR","./Logger":"andi"}],"hNUz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InvalidStateError=exports.UnsupportedError=void 0;class r extends Error{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(t).stack}}exports.UnsupportedError=r;class t extends Error{constructor(r){super(r),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,t):this.stack=new Error(r).stack}}exports.InvalidStateError=t;
},{}],"fnp2":[function(require,module,exports) {
"use strict";function e(e,r){return void 0===e?r:JSON.parse(JSON.stringify(e))}function r(){return Math.round(1e7*Math.random())}Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateRandomNumber=exports.clone=void 0,exports.clone=e,exports.generateRandomNumber=r;
},{}],"lc3R":[function(require,module,exports) {
const e=require("debug")("h264-profile-level-id");e.log=console.info.bind(console);const r=1,l=2,o=3,s=4,t=5;exports.ProfileConstrainedBaseline=1,exports.ProfileBaseline=2,exports.ProfileMain=3,exports.ProfileConstrainedHigh=4,exports.ProfileHigh=5;const i=0,n=10,p=11,f=12,a=13,c=20,d=21,v=22,u=30,x=31,L=32,w=40,_=41,h=42,P=50,g=51,I=52;exports.Level1_b=i,exports.Level1=n,exports.Level1_1=11,exports.Level1_2=12,exports.Level1_3=13,exports.Level2=20,exports.Level2_1=21,exports.Level2_2=22,exports.Level3=30,exports.Level3_1=31,exports.Level3_2=32,exports.Level4=40,exports.Level4_1=41,exports.Level4_2=42,exports.Level5=50,exports.Level5_1=51,exports.Level5_2=52;class b{constructor(e,r){this.profile=e,this.level=r}}exports.ProfileLevelId=b;const m=new b(1,31),k=16;class S{constructor(e){this._mask=~z("x",e),this._maskedValue=z("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class T{constructor(e,r,l){this.profile_idc=e,this.profile_iop=r,this.profile=l}}const y=[new T(66,new S("x1xx0000"),1),new T(77,new S("1xxx0000"),1),new T(88,new S("11xx0000"),1),new T(66,new S("x0xx0000"),2),new T(88,new S("10xx0000"),2),new T(77,new S("0x0x0000"),3),new T(100,new S("00000000"),5),new T(100,new S("00001100"),4)];function z(e,r){return(r[0]===e)<<7|(r[1]===e)<<6|(r[2]===e)<<5|(r[3]===e)<<4|(r[4]===e)<<3|(r[5]===e)<<2|(r[6]===e)<<1|(r[7]===e)<<0}function A(e,r){return e===i?r!==n&&r!==i:r===i?e!==n:e<r}function B(e,r){return A(e,r)?e:r}function E(e={}){const r=e["level-asymmetry-allowed"];return 1===r||"1"===r}exports.parseProfileLevelId=function(r){if("string"!=typeof r||6!==r.length)return null;const l=parseInt(r,16);if(0===l)return null;const o=255&l,s=l>>8&255,t=l>>16&255;let p;switch(o){case 11:p=0!=(16&s)?i:11;break;case n:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:p=o;break;default:return e("parseProfileLevelId() | unrecognized level_idc:%s",o),null}for(const e of y)if(t===e.profile_idc&&e.profile_iop.isMatch(s))return new b(e.profile,p);return e("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},exports.profileLevelIdToString=function(r){if(r.level==i)switch(r.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return e("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",r.profile),null}let l;switch(r.profile){case 1:l="42e0";break;case 2:l="4200";break;case 3:l="4d00";break;case 4:l="640c";break;case 5:l="6400";break;default:return e("profileLevelIdToString() | unrecognized profile:%s",r.profile),null}let o=r.level.toString(16);return 1===o.length&&(o=`0${o}`),`${l}${o}`},exports.parseSdpProfileLevelId=function(e={}){const r=e["profile-level-id"];return r?exports.parseProfileLevelId(r):m},exports.isSameProfile=function(e={},r={}){const l=exports.parseSdpProfileLevelId(e),o=exports.parseSdpProfileLevelId(r);return Boolean(l&&o&&l.profile===o.profile)},exports.generateProfileLevelIdForAnswer=function(r={},l={}){if(!r["profile-level-id"]&&!l["profile-level-id"])return e("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const o=exports.parseSdpProfileLevelId(r),s=exports.parseSdpProfileLevelId(l);if(!o)throw new TypeError("invalid local_profile_level_id");if(!s)throw new TypeError("invalid remote_profile_level_id");if(o.profile!==s.profile)throw new TypeError("H264 Profile mismatch");const t=E(r)&&E(l),i=o.level,n=B(i,s.level),p=t?i:n;return e("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",o.profile,p),exports.profileLevelIdToString(new b(o.profile,p))};
},{"debug":"jD9Y"}],"y0TR":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t),Object.defineProperty(e,o,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]}),r=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),t=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var a in t)"default"!==a&&Object.hasOwnProperty.call(t,a)&&e(o,t,a);return r(o,t),o};Object.defineProperty(exports,"__esModule",{value:!0}),exports.canReceive=exports.canSend=exports.generateProbatorRtpParameters=exports.reduceCodecs=exports.getSendingRemoteRtpParameters=exports.getSendingRtpParameters=exports.getRecvRtpCapabilities=exports.getExtendedRtpCapabilities=exports.validateSctpStreamParameters=exports.validateSctpParameters=exports.validateNumSctpStreams=exports.validateSctpCapabilities=exports.validateRtcpParameters=exports.validateRtpEncodingParameters=exports.validateRtpHeaderExtensionParameters=exports.validateRtpCodecParameters=exports.validateRtpParameters=exports.validateRtpHeaderExtension=exports.validateRtcpFeedback=exports.validateRtpCodecCapability=exports.validateRtpCapabilities=void 0;const o=t(require("h264-profile-level-id")),a=t(require("./utils")),n="probator",i=1234,c=127;function s(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const r of e.codecs)p(r);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const r of e.headerExtensions)y(r)}function p(e){const r=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const t=r.exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(e.kind=t[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const o of Object.keys(e.parameters)){let r=e.parameters[o];if(void 0===r&&(e.parameters[o]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${o}s, value:${r}]`);if("apt"===o&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const o of e.rtcpFeedback)d(o)}function d(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function y(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(e.kind&&"string"==typeof e.kind||(e.kind=""),""!==e.kind&&"audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function f(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const r of e.codecs)m(r);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const r of e.headerExtensions)l(r);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const r of e.encodings)u(r);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),h(e.rtcp)}function m(e){const r=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const t=r.exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===t[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const o of Object.keys(e.parameters)){let r=e.parameters[o];if(void 0===r&&(e.parameters[o]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${o}s, value:${r}]`);if("apt"===o&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const o of e.rtcpFeedback)d(o)}function l(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const r of Object.keys(e.parameters)){let t=e.parameters[r];if(void 0===t&&(e.parameters[r]="",t=""),"string"!=typeof t&&"number"!=typeof t)throw new TypeError("invalid header extension parameter")}}function u(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function h(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function w(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");x(e.numStreams)}function x(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function b(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")}function T(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let r=!1;if("boolean"==typeof e.ordered?r=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(r&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(r||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.priority&&"string"!=typeof e.priority)throw new TypeError("invalid params.priority");if(e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")}function E(e,r){const t={codecs:[],headerExtensions:[]};for(const o of r.codecs||[]){if(F(o))continue;const r=(e.codecs||[]).find(e=>C(e,o,{strict:!0,modify:!0}));if(!r)continue;const a={mimeType:r.mimeType,kind:r.kind,clockRate:r.clockRate,channels:r.channels,localPayloadType:r.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:o.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:r.parameters,remoteParameters:o.parameters,rtcpFeedback:A(r,o)};t.codecs.push(a)}for(const o of t.codecs){const t=e.codecs.find(e=>F(e)&&e.parameters.apt===o.localPayloadType),a=r.codecs.find(e=>F(e)&&e.parameters.apt===o.remotePayloadType);t&&a&&(o.localRtxPayloadType=t.preferredPayloadType,o.remoteRtxPayloadType=a.preferredPayloadType)}for(const o of r.headerExtensions){const r=e.headerExtensions.find(e=>I(e,o));if(!r)continue;const a={kind:o.kind,uri:o.uri,sendId:r.preferredId,recvId:o.preferredId,encrypt:r.preferredEncrypt,direction:"sendrecv"};switch(o.direction){case"sendrecv":a.direction="sendrecv";break;case"recvonly":a.direction="sendonly";break;case"sendonly":a.direction="recvonly";break;case"inactive":a.direction="inactive"}t.headerExtensions.push(a)}return t}function k(e){const r={codecs:[],headerExtensions:[]};for(const t of e.codecs){const e={mimeType:t.mimeType,kind:t.kind,preferredPayloadType:t.remotePayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(r.codecs.push(e),!t.remoteRtxPayloadType)continue;const o={mimeType:`${t.kind}/rtx`,kind:t.kind,preferredPayloadType:t.remoteRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.remotePayloadType},rtcpFeedback:[]};r.codecs.push(o)}for(const t of e.headerExtensions){if("sendrecv"!==t.direction&&"recvonly"!==t.direction)continue;const e={kind:t.kind,uri:t.uri,preferredId:t.recvId,preferredEncrypt:t.encrypt,direction:t.direction};r.headerExtensions.push(e)}return r}function v(e,r){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const o of r.codecs){if(o.kind!==e)continue;const r={mimeType:o.mimeType,payloadType:o.localPayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.localParameters,rtcpFeedback:o.rtcpFeedback};if(t.codecs.push(r),o.localRtxPayloadType){const e={mimeType:`${o.kind}/rtx`,payloadType:o.localRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.localPayloadType},rtcpFeedback:[]};t.codecs.push(e)}}for(const o of r.headerExtensions){if(o.kind&&o.kind!==e||"sendrecv"!==o.direction&&"sendonly"!==o.direction)continue;const r={uri:o.uri,id:o.sendId,encrypt:o.encrypt,parameters:{}};t.headerExtensions.push(r)}return t}function g(e,r){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const o of r.codecs){if(o.kind!==e)continue;const r={mimeType:o.mimeType,payloadType:o.localPayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.remoteParameters,rtcpFeedback:o.rtcpFeedback};if(t.codecs.push(r),o.localRtxPayloadType){const e={mimeType:`${o.kind}/rtx`,payloadType:o.localRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.localPayloadType},rtcpFeedback:[]};t.codecs.push(e)}}for(const o of r.headerExtensions){if(o.kind&&o.kind!==e||"sendrecv"!==o.direction&&"sendonly"!==o.direction)continue;const r={uri:o.uri,id:o.sendId,encrypt:o.encrypt,parameters:{}};t.headerExtensions.push(r)}if(t.headerExtensions.some(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri))for(const o of t.codecs)o.rtcpFeedback=(o.rtcpFeedback||[]).filter(e=>"goog-remb"!==e.type);else if(t.headerExtensions.some(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri))for(const o of t.codecs)o.rtcpFeedback=(o.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type);else for(const o of t.codecs)o.rtcpFeedback=(o.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type&&"goog-remb"!==e.type);return t}function R(e,r){const t=[];if(r){for(let o=0;o<e.length;++o)if(C(e[o],r)){t.push(e[o]),F(e[o+1])&&t.push(e[o+1]);break}if(0===t.length)throw new TypeError("no matching codec found")}else t.push(e[0]),F(e[1])&&t.push(e[1]);return t}function P(e){f(e=a.clone(e,{}));const r={mid:n,codecs:[],headerExtensions:[],encodings:[{ssrc:i}],rtcp:{cname:"probator"}};return r.codecs.push(e.codecs[0]),r.codecs[0].payloadType=c,r.headerExtensions=e.headerExtensions,r}function j(e,r){return r.codecs.some(r=>r.kind===e)}function S(e,r){if(f(e),0===e.codecs.length)return!1;const t=e.codecs[0];return r.codecs.some(e=>e.remotePayloadType===t.payloadType)}function F(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function C(e,r,{strict:t=!1,modify:a=!1}={}){const n=e.mimeType.toLowerCase();if(n!==r.mimeType.toLowerCase())return!1;if(e.clockRate!==r.clockRate)return!1;if(e.channels!==r.channels)return!1;switch(n){case"video/h264":if((e.parameters["packetization-mode"]||0)!==(r.parameters["packetization-mode"]||0))return!1;if(t){if(!o.isSameProfile(e.parameters,r.parameters))return!1;let t;try{t=o.generateProfileLevelIdForAnswer(e.parameters,r.parameters)}catch(i){return!1}a&&(t?(e.parameters["profile-level-id"]=t,r.parameters["profile-level-id"]=t):(delete e.parameters["profile-level-id"],delete r.parameters["profile-level-id"]))}break;case"video/vp9":if(t){if((e.parameters["profile-id"]||0)!==(r.parameters["profile-id"]||0))return!1}}return!0}function I(e,r){return(!e.kind||!r.kind||e.kind===r.kind)&&e.uri===r.uri}function A(e,r){const t=[];for(const o of e.rtcpFeedback||[]){const e=(r.rtcpFeedback||[]).find(e=>e.type===o.type&&(e.parameter===o.parameter||!e.parameter&&!o.parameter));e&&t.push(e)}return t}exports.validateRtpCapabilities=s,exports.validateRtpCodecCapability=p,exports.validateRtcpFeedback=d,exports.validateRtpHeaderExtension=y,exports.validateRtpParameters=f,exports.validateRtpCodecParameters=m,exports.validateRtpHeaderExtensionParameters=l,exports.validateRtpEncodingParameters=u,exports.validateRtcpParameters=h,exports.validateSctpCapabilities=w,exports.validateNumSctpStreams=x,exports.validateSctpParameters=b,exports.validateSctpStreamParameters=T,exports.getExtendedRtpCapabilities=E,exports.getRecvRtpCapabilities=k,exports.getSendingRtpParameters=v,exports.getSendingRemoteRtpParameters=g,exports.reduceCodecs=R,exports.generateProbatorRtpParameters=P,exports.canSend=j,exports.canReceive=S;
},{"h264-profile-level-id":"lc3R","./utils":"fnp2"}],"OGUt":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{a(r.next(e))}catch(t){i(t)}}function d(e){try{a(r.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,d)}a((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(t,s){return e(this,void 0,void 0,function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof t)throw new TypeError("given task is not a function");if(!t.name&&s)try{Object.defineProperty(t,"name",{value:s})}catch(e){}return new Promise((e,r)=>{const n={task:t,name:s,resolve:e,reject:r,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(n),1===this.pendingTasks.length&&this.next()})})}stop(){if(!this.closed){for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const e=new Date;return this.pendingTasks.map(t=>({task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0}))}next(){return e(this,void 0,void 0,function*(){const e=this.pendingTasks[0];e&&(yield this.executeTask(e),this.pendingTasks.shift(),this.next())})}executeTask(t){return e(this,void 0,void 0,function*(){if(!t.stopped){t.executedAt=new Date;try{const s=yield t.task();if(t.stopped)return;t.resolve(s)}catch(e){if(t.stopped)return;t.reject(e)}}})}}exports.AwaitQueue=t;
},{}],"dKU8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Producer=void 0;const e=require("./Logger"),t=require("./EnhancedEventEmitter"),r=require("./errors"),s=new e.Logger("Producer");class a extends t.EnhancedEventEmitter{constructor({id:e,localId:r,rtpSender:a,track:i,rtpParameters:d,stopTracks:o,disableTrackOnPause:c,zeroRtpOnPause:n,appData:h}){super(),this._closed=!1,this._observer=new t.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._localId=r,this._rtpSender=a,this._track=i,this._kind=i.kind,this._rtpParameters=d,this._paused=!!c&&!i.enabled,this._maxSpatialLayer=void 0,this._stopTracks=o,this._disableTrackOnPause=c,this._zeroRtpOnPause=n,this._appData=h,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new r.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){s.debug("pause()"),this._closed?s.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch(()=>{}),this._observer.safeEmit("pause"))}resume(){s.debug("resume()"),this._closed?s.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch(()=>{}),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(s.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(t){}throw new r.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new r.InvalidStateError("track ended");e!==this._track?(this._zeroRtpOnPause&&this._paused||await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()):s.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new r.InvalidStateError("closed");if("video"!==this._kind)throw new r.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new r.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}exports.Producer=a;
},{"./Logger":"andi","./EnhancedEventEmitter":"P3Oo","./errors":"hNUz"}],"QQSC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Consumer=void 0;const e=require("./Logger"),t=require("./EnhancedEventEmitter"),r=require("./errors"),s=new e.Logger("Consumer");class a extends t.EnhancedEventEmitter{constructor({id:e,localId:r,producerId:a,rtpReceiver:i,track:d,rtpParameters:o,appData:c}){super(),this._closed=!1,this._observer=new t.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._localId=r,this._producerId=a,this._rtpReceiver=i,this._track=d,this._rtpParameters=o,this._paused=!d.enabled,this._appData=c,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new r.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){s.debug("pause()"),this._closed?s.error("pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause"))}resume(){s.debug("resume()"),this._closed?s.error("resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume"))}_onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}}exports.Consumer=a;
},{"./Logger":"andi","./EnhancedEventEmitter":"P3Oo","./errors":"hNUz"}],"Z0Ve":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataProducer=void 0;const e=require("./Logger"),t=require("./EnhancedEventEmitter"),a=require("./errors"),r=new e.Logger("DataProducer");class s extends t.EnhancedEventEmitter{constructor({id:e,dataChannel:a,sctpStreamParameters:s,appData:n}){super(),this._closed=!1,this._observer=new t.EnhancedEventEmitter,r.debug("constructor()"),this._id=e,this._dataChannel=a,this._sctpStreamParameters=s,this._appData=n,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(r.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(r.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(r.debug("send()"),this._closed)throw new a.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(r.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?r.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):r.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(r.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||r.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}exports.DataProducer=s;
},{"./Logger":"andi","./EnhancedEventEmitter":"P3Oo","./errors":"hNUz"}],"g5am":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataConsumer=void 0;const e=require("./Logger"),t=require("./EnhancedEventEmitter"),a=new e.Logger("DataConsumer");class r extends t.EnhancedEventEmitter{constructor({id:e,dataProducerId:r,dataChannel:s,sctpStreamParameters:n,appData:o}){super(),this._closed=!1,this._observer=new t.EnhancedEventEmitter,a.debug("constructor()"),this._id=e,this._dataProducerId=r,this._dataChannel=s,this._sctpStreamParameters=n,this._appData=o,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(a.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(a.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(a.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?a.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):a.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(a.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}exports.DataConsumer=r;
},{"./Logger":"andi","./EnhancedEventEmitter":"P3Oo"}],"BHpp":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var a={};if(null!=r)for(var s in r)"default"!==s&&Object.hasOwnProperty.call(r,s)&&e(a,r,s);return t(a,r),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transport=void 0;const a=require("awaitqueue"),s=require("./Logger"),o=require("./EnhancedEventEmitter"),n=require("./errors"),i=r(require("./utils")),c=r(require("./ortc")),d=require("./Producer"),p=require("./Consumer"),h=require("./DataProducer"),l=require("./DataConsumer"),u=new s.Logger("Transport");class m extends o.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:s,dtlsParameters:c,sctpParameters:d,iceServers:p,iceTransportPolicy:h,additionalSettings:l,proprietaryConstraints:m,appData:w,handlerFactory:_,extendedRtpCapabilities:y,canProduceByKind:f}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new a.AwaitQueue({ClosedErrorClass:n.InvalidStateError}),this._observer=new o.EnhancedEventEmitter,u.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=y,this._canProduceByKind=f,this._maxSctpMessageSize=d?d.maxMessageSize:null,delete(l=i.clone(l,{})).iceServers,delete l.iceTransportPolicy,delete l.bundlePolicy,delete l.rtcpMuxPolicy,delete l.sdpSemantics,this._handler=_(),this._handler.run({direction:e,iceParameters:r,iceCandidates:s,dtlsParameters:c,sctpParameters:d,iceServers:p,iceTransportPolicy:h,additionalSettings:l,proprietaryConstraints:m,extendedRtpCapabilities:y}),this._appData=w,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){u.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new n.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(u.debug("restartIce()"),this._closed)throw new n.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(u.debug("updateIceServers()"),this._closed)throw new n.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:a,stopTracks:s=!0,disableTrackOnPause:o=!0,zeroRtpOnPause:i=!1,appData:p={}}={}){if(u.debug("produce() [track:%o]",e),!e)throw new TypeError("missing track");if("send"!==this._direction)throw new n.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new n.UnsupportedError(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new n.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(p&&"object"!=typeof p)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let n;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?n=void 0:t&&(n=t.map(e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t}));const{localId:h,rtpParameters:l,rtpSender:u}=await this._handler.send({track:e,encodings:n,codecOptions:r,codec:a});try{c.validateRtpParameters(l);const{id:t}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:l,appData:p}),r=new d.Producer({id:t,localId:h,rtpSender:u,track:e,rtpParameters:l,stopTracks:s,disableTrackOnPause:o,zeroRtpOnPause:i,appData:p});return this._producers.set(r.id,r),this._handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(m){throw this._handler.stopSending(h).catch(()=>{}),m}},"transport.produce()").catch(t=>{if(s)try{e.stop()}catch(r){}throw t})}async consume({id:e,producerId:t,kind:r,rtpParameters:a,appData:s={}}){if(u.debug("consume()"),a=i.clone(a,void 0),this._closed)throw new n.InvalidStateError("closed");if("recv"!==this._direction)throw new n.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{if(!c.canReceive(a,this._extendedRtpCapabilities))throw new n.UnsupportedError("cannot consume this Producer");const{localId:o,rtpReceiver:i,track:d}=await this._handler.receive({trackId:e,kind:r,rtpParameters:a}),h=new p.Consumer({id:e,localId:o,producerId:t,rtpReceiver:i,track:d,rtpParameters:a,appData:s});if(this._consumers.set(h.id,h),this._handleConsumer(h),!this._probatorConsumerCreated&&"video"===r)try{const e=c.generateProbatorRtpParameters(h.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:e}),u.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(l){u.error("consume() | failed to create Consumer for RTP probation:%o",l)}return this._observer.safeEmit("newconsumer",h),h},"transport.consume()")}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,priority:a="low",label:s="",protocol:o="",appData:i={}}={}){if(u.debug("produceData()"),"send"!==this._direction)throw new n.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new n.UnsupportedError("SCTP not enabled by remote Transport");if(!["very-low","low","medium","high"].includes(a))throw new TypeError("wrong priority");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return(t||r)&&(e=!1),this._awaitQueue.push(async()=>{const{dataChannel:n,sctpStreamParameters:d}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,priority:a,label:s,protocol:o});c.validateSctpStreamParameters(d);const{id:p}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:d,label:s,protocol:o,appData:i}),l=new h.DataProducer({id:p,dataChannel:n,sctpStreamParameters:d,appData:i});return this._dataProducers.set(l.id,l),this._handleDataProducer(l),this._observer.safeEmit("newdataproducer",l),l},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:a="",protocol:s="",appData:o={}}){if(u.debug("consumeData()"),r=i.clone(r,void 0),this._closed)throw new n.InvalidStateError("closed");if("recv"!==this._direction)throw new n.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new n.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(o&&"object"!=typeof o)throw new TypeError("if given, appData must be an object");return c.validateSctpStreamParameters(r),this._awaitQueue.push(async()=>{const{dataChannel:n}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:a,protocol:s}),i=new l.DataConsumer({id:e,dataProducerId:t,dataChannel:n,sctpStreamParameters:r,appData:o});return this._dataConsumers.set(i.id,i),this._handleDataConsumer(i),this._observer.safeEmit("newdataconsumer",i),i},"transport.consumeData()")}_handleHandler(){const e=this._handler;e.on("@connect",({dtlsParameters:e},t,r)=>{this._closed?r(new n.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)}),e.on("@connectionstatechange",e=>{e!==this._connectionState&&(u.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))})}_handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push(async()=>this._handler.stopSending(e.localId),"producer @close event").catch(e=>u.warn("producer.close() failed:%o",e))}),e.on("@replacetrack",(t,r,a)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(r).catch(a)}),e.on("@setmaxspatiallayer",(t,r,a)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(r).catch(a)}),e.on("@setrtpencodingparameters",(t,r,a)=>{this._awaitQueue.push(async()=>this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(r).catch(a)}),e.on("@getstats",(t,r)=>{if(this._closed)return r(new n.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)})}_handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id),this._closed||this._awaitQueue.push(async()=>this._handler.stopReceiving(e.localId),"consumer @close event").catch(()=>{})}),e.on("@getstats",(t,r)=>{if(this._closed)return r(new n.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)})}_handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}_handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}exports.Transport=m;
},{"awaitqueue":"OGUt","./Logger":"andi","./EnhancedEventEmitter":"P3Oo","./errors":"hNUz","./utils":"fnp2","./ortc":"y0TR","./Producer":"dKU8","./Consumer":"QQSC","./DataProducer":"Z0Ve","./DataConsumer":"g5am"}],"VF80":[function(require,module,exports) {
var e=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var r="candidate:%s %d %s %d %s %d typ %s";return r+=null!=e.raddr?" raddr %s rport %d":"%v%v",r+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(r+=" generation %d"),r+=null!=e["network-id"]?" network-id %d":"%v",r+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var r="ssrc:%d";return null!=e.attribute&&(r+=" %s",null!=e.value&&(r+=":%s")),r}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var r="mediaclk:";return r+=null!=e.id?"id=%s %s":"%v%s",r+=null!=e.mediaClockValue?"=%s":"",r+=null!=e.rateNumerator?" rate=%s":"",r+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(e).forEach(function(r){e[r].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});
},{}],"pJ4u":[function(require,module,exports) {
var r=function(r){return String(Number(r))===r?Number(r):r},t=function(t,e,n,s){if(s&&!n)e[s]=r(t[1]);else for(var a=0;a<n.length;a+=1)null!=t[a+1]&&(e[n[a]]=r(t[a+1]))},e=function(r,e,n){var s=r.name&&r.names;r.push&&!e[r.push]?e[r.push]=[]:s&&!e[r.name]&&(e[r.name]={});var a=r.push?{}:s?e[r.name]:e;t(n.match(r.reg),a,r.names,r.name),r.push&&e[r.push].push(a)},n=require("./grammar"),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(r){var t={},a=[],p=t;return r.split(/(\r\n|\r|\n)/).filter(s).forEach(function(r){var t=r[0],s=r.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),p=a[a.length-1]);for(var u=0;u<(n[t]||[]).length;u+=1){var i=n[t][u];if(i.reg.test(s))return e(i,p,s)}}),t.media=a,t};var a=function(t,e){var n=e.split(/=(.+)/,2);return 2===n.length?t[n[0]]=r(n[1]):1===n.length&&e.length>1&&(t[n[0]]=void 0),t};exports.parseParams=function(r){return r.split(/;\s?/).reduce(a,{})},exports.parseFmtpConfig=exports.parseParams,exports.parsePayloads=function(r){return r.toString().split(" ").map(Number)},exports.parseRemoteCandidates=function(t){for(var e=[],n=t.split(" ").map(r),s=0;s<n.length;s+=3)e.push({component:n[s],ip:n[s+1],port:n[s+2]});return e},exports.parseImageAttributes=function(r){return r.split(" ").map(function(r){return r.substring(1,r.length-1).split(",").reduce(a,{})})},exports.parseSimulcastStreamList=function(t){return t.split(";").map(function(t){return t.split(",").map(function(t){var e,n=!1;return"~"!==t[0]?e=r(t):(e=r(t.substring(1,t.length)),n=!0),{scid:e,paused:n}})})};
},{"./grammar":"VF80"}],"dFSN":[function(require,module,exports) {
var n=require("./grammar"),r=/%[sdv%]/g,a=function(n){var a=1,u=arguments,e=u.length;return n.replace(r,function(n){if(a>=e)return n;var r=u[a];switch(a+=1,n){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},u=function(n,r,u){var e=[n+"="+(r.format instanceof Function?r.format(r.push?u:u[r.name]):r.format)];if(r.names)for(var o=0;o<r.names.length;o+=1){var s=r.names[o];r.name?e.push(u[r.name][s]):e.push(u[r.names[o]])}else e.push(u[r.name]);return a.apply(null,e)},e=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];module.exports=function(r,a){a=a||{},null==r.version&&(r.version=0),null==r.name&&(r.name=" "),r.media.forEach(function(n){null==n.payloads&&(n.payloads="")});var s=a.outerOrder||e,t=a.innerOrder||o,i=[];return s.forEach(function(a){n[a].forEach(function(n){n.name in r&&null!=r[n.name]?i.push(u(a,n,r)):n.push in r&&null!=r[n.push]&&r[n.push].forEach(function(r){i.push(u(a,n,r))})})}),r.media.forEach(function(r){i.push(u("m",n.m[0],r)),t.forEach(function(a){n[a].forEach(function(n){n.name in r&&null!=r[n.name]?i.push(u(a,n,r)):n.push in r&&null!=r[n.push]&&r[n.push].forEach(function(r){i.push(u(a,n,r))})})})}),i.join("\r\n")+"\r\n"};
},{"./grammar":"VF80"}],"CfIM":[function(require,module,exports) {
var e=require("./parser"),r=require("./writer");exports.write=r,exports.parse=e.parse,exports.parseParams=e.parseParams,exports.parseFmtpConfig=e.parseFmtpConfig,exports.parsePayloads=e.parsePayloads,exports.parseRemoteCandidates=e.parseRemoteCandidates,exports.parseImageAttributes=e.parseImageAttributes,exports.parseSimulcastStreamList=e.parseSimulcastStreamList;
},{"./parser":"pJ4u","./writer":"dFSN"}],"p5WR":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var o={};if(null!=r)for(var a in r)"default"!==a&&Object.hasOwnProperty.call(r,a)&&e(o,r,a);return t(o,r),o};Object.defineProperty(exports,"__esModule",{value:!0}),exports.applyCodecParameters=exports.getCname=exports.extractDtlsParameters=exports.extractRtpCapabilities=void 0;const o=r(require("sdp-transform"));function a({sdpObject:e}){const t=new Map,r=[];let a=!1,n=!1;for(const i of e.media){const e=i.type;switch(e){case"audio":if(a)continue;a=!0;break;case"video":if(n)continue;n=!0;break;default:continue}for(const r of i.rtp){const o={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(o.preferredPayloadType,o)}for(const r of i.fmtp||[]){const e=o.parseParams(r.config),a=t.get(r.payload);a&&(e&&e["profile-level-id"]&&(e["profile-level-id"]=String(e["profile-level-id"])),a.parameters=e)}for(const r of i.rtcpFb||[]){const e=t.get(r.payload);if(!e)continue;const o={type:r.type,parameter:r.subtype};o.parameter||delete o.parameter,e.rtcpFeedback.push(o)}for(const t of i.ext||[]){if(t["encrypt-uri"])continue;const o={kind:e,uri:t.uri,preferredId:t.value};r.push(o)}}return{codecs:Array.from(t.values()),headerExtensions:r}}function n({sdpObject:e}){const t=(e.media||[]).find(e=>e.iceUfrag&&0!==e.port);if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let o;switch(t.setup){case"active":o="client";break;case"passive":o="server";break;case"actpass":o="auto"}return{role:o,fingerprints:[{algorithm:r.type,value:r.hash}]}}function i({offerMediaObject:e}){const t=(e.ssrcs||[]).find(e=>"cname"===e.attribute);return t?t.value:""}function s({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e)continue;if(!(t.rtp||[]).find(e=>e.payload===r.payloadType))continue;t.fmtp=t.fmtp||[];let a=t.fmtp.find(e=>e.payload===r.payloadType);a||(a={payload:r.payloadType,config:""},t.fmtp.push(a));const n=o.parseParams(a.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(n.stereo=e?1:0);break}}a.config="";for(const t of Object.keys(n))a.config&&(a.config+=";"),a.config+=`${t}=${n[t]}`}}exports.extractRtpCapabilities=a,exports.extractDtlsParameters=n,exports.getCname=i,exports.applyCodecParameters=s;
},{"sdp-transform":"CfIM"}],"C7JJ":[function(require,module,exports) {
"use strict";function s({offerMediaObject:s}){const t=new Set;for(const o of s.ssrcs||[]){const s=o.id;t.add(s)}if(0===t.size)throw new Error("no a=ssrc lines found");const e=new Map;for(const o of s.ssrcGroups||[]){if("FID"!==o.semantics)continue;let[s,r]=o.ssrcs.split(/\s+/);s=Number(s),r=Number(r),t.has(s)&&(t.delete(s),t.delete(r),e.set(s,r))}for(const o of t)e.set(o,null);const r=[];for(const[o,n]of e){const s={ssrc:o};n&&(s.rtx={ssrc:n}),r.push(s)}return r}function t({offerMediaObject:s,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const e=(s.ssrcs||[]).find(s=>"msid"===s.attribute);if(!e)throw new Error("a=ssrc line with msid information not found");const[r,o]=e.value.split(" ")[0],n=e.id;let c;(s.ssrcGroups||[]).some(s=>{if("FID"!==s.semantics)return!1;const t=s.ssrcs.split(/\s+/);return Number(t[0])===n&&(c=Number(t[1]),!0)});const i=s.ssrcs.find(s=>"cname"===s.attribute);if(!i)throw new Error("a=ssrc line with cname information not found");const u=i.value,a=[],f=[];for(let d=0;d<t;++d)a.push(n+d),c&&f.push(c+d);s.ssrcGroups=[],s.ssrcs=[],s.ssrcGroups.push({semantics:"SIM",ssrcs:a.join(" ")});for(let d=0;d<a.length;++d){const t=a[d];s.ssrcs.push({id:t,attribute:"cname",value:u}),s.ssrcs.push({id:t,attribute:"msid",value:`${r} ${o}`})}for(let d=0;d<f.length;++d){const t=a[d],e=f[d];s.ssrcs.push({id:e,attribute:"cname",value:u}),s.ssrcs.push({id:e,attribute:"msid",value:`${r} ${o}`}),s.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${e}`})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addLegacySimulcast=exports.getRtpEncodings=void 0,exports.getRtpEncodings=s,exports.addLegacySimulcast=t;
},{}],"JfyM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HandlerInterface=void 0;const e=require("../EnhancedEventEmitter");class t extends e.EnhancedEventEmitter{constructor(){super()}}exports.HandlerInterface=t;
},{"../EnhancedEventEmitter":"P3Oo"}],"SdHv":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var s={};if(null!=i)for(var a in i)"default"!==a&&Object.hasOwnProperty.call(i,a)&&e(s,i,a);return t(s,i),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OfferMediaSection=exports.AnswerMediaSection=exports.MediaSection=void 0;const s=i(require("../../utils"));class a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:s=!1}){if(this._mediaObject={},this._planB=s,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}i&&this.setDtlsRole(i.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}exports.MediaSection=a;class c extends a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:a,plainRtpParameters:c,planB:r=!1,offerMediaObject:o,offerRtpParameters:p,answerRtpParameters:m,codecOptions:n,extmapAllowMixed:h=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:r}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,c?(this._mediaObject.connection={ip:c.ip,version:c.ipVersion},this._mediaObject.port=c.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of m.codecs){const t={payload:e.payloadType,codec:d(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const i=s.clone(e.parameters,{});if(n){const{opusStereo:t,opusFec:s,opusDtx:a,opusMaxPlaybackRate:c,opusMaxAverageBitrate:r,opusPtime:d,videoGoogleStartBitrate:o,videoGoogleMaxBitrate:m,videoGoogleMinBitrate:h}=n,l=p.codecs.find(t=>t.payloadType===e.payloadType);switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==t&&(l.parameters["sprop-stereo"]=t?1:0,i.stereo=t?1:0),void 0!==s&&(l.parameters.useinbandfec=s?1:0,i.useinbandfec=s?1:0),void 0!==a&&(l.parameters.usedtx=a?1:0,i.usedtx=a?1:0),void 0!==c&&(i.maxplaybackrate=c),void 0!==r&&(i.maxaveragebitrate=r),void 0!==d&&(l.parameters.ptime=d,i.ptime=d);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==o&&(i["x-google-start-bitrate"]=o),void 0!==m&&(i["x-google-max-bitrate"]=m),void 0!==h&&(i["x-google-min-bitrate"]=h)}}const a={payload:e.payloadType,config:""};for(const e of Object.keys(i))a.config&&(a.config+=";"),a.config+=`${e}=${i[e]}`;a.config&&this._mediaObject.fmtp.push(a);for(const s of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:s.type,subtype:s.parameter})}this._mediaObject.payloads=m.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const e of m.headerExtensions){(o.ext||[]).some(t=>t.uri===e.uri)&&this._mediaObject.ext.push({uri:e.uri,value:e.id})}if(h&&"extmap-allow-mixed"===o.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof o.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=a.port,this._mediaObject.maxMessageSize=a.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=a.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:a.port,maxMessageSize:a.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}}exports.AnswerMediaSection=c;class r extends a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:s,plainRtpParameters:a,planB:c=!1,mid:r,kind:o,offerRtpParameters:p,streamId:m,trackId:n,oldDataChannelSpec:h=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:c}),this._mediaObject.mid=String(r),this._mediaObject.type=o,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=s?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),o){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${m||"-"} ${n}`);for(const s of p.codecs){const e={payload:s.payloadType,codec:d(s),rate:s.clockRate};s.channels>1&&(e.encoding=s.channels),this._mediaObject.rtp.push(e);const t={payload:s.payloadType,config:""};for(const i of Object.keys(s.parameters))t.config&&(t.config+=";"),t.config+=`${i}=${s.parameters[i]}`;t.config&&this._mediaObject.fmtp.push(t);for(const i of s.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:s.payloadType,type:i.type,subtype:i.parameter})}this._mediaObject.payloads=p.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const s of p.headerExtensions)this._mediaObject.ext.push({uri:s.uri,value:s.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=p.encodings[0],t=e.ssrc,i=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],p.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:p.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${m||"-"} ${n}`}),i&&(p.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:p.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${m||"-"} ${n}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${i}`}));break}case"application":h?(this._mediaObject.payloads=s.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=s.port,this._mediaObject.maxMessageSize=s.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:i}){const s=e.encodings[0],a=s.ssrc,c=s.rtx&&s.rtx.ssrc?s.rtx.ssrc:void 0;e.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${t||"-"} ${i}`}),c&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:c,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:c,attribute:"msid",value:`${t||"-"} ${i}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${a} ${c}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],i=t.ssrc,s=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==i&&e.id!==s),s&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>e.ssrcs!==`${i} ${s}`))}}function d(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}exports.OfferMediaSection=r;
},{"../../utils":"fnp2"}],"vZFf":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var s={};if(null!=i)for(var a in i)"default"!==a&&Object.hasOwnProperty.call(i,a)&&e(s,i,a);return t(s,i),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RemoteSdp=void 0;const s=i(require("sdp-transform")),a=require("../../Logger"),r=require("./MediaSection"),d=new a.Logger("RemoteSdp");class n{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:s,plainRtpParameters:a,planB:r=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=i,this._sctpParameters=s,this._plainRtpParameters=a,this._planB=r,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),i){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:i.fingerprints[e-1].algorithm,hash:i.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}a&&(this._sdpObject.origin.address=a.ip,this._sdpObject.origin.ipVer=a.ipVersion)}updateIceParameters(e){d.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){d.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:i,answerRtpParameters:s,codecOptions:a,extmapAllowMixed:d=!1}){const n=new r.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:i,answerRtpParameters:s,codecOptions:a,extmapAllowMixed:d});t?this._replaceMediaSection(n,t):this._midToIndex.has(n.mid)?this._replaceMediaSection(n):this._addMediaSection(n)}receive({mid:e,kind:t,offerRtpParameters:i,streamId:s,trackId:a}){const d=this._midToIndex.get(e);let n;if(void 0!==d&&(n=this._mediaSections[d]),n)n.planBReceive({offerRtpParameters:i,streamId:s,trackId:a}),this._replaceMediaSection(n);else{n=new r.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:i,streamId:s,trackId:a});const d=this._mediaSections.find(e=>e.closed);d?this._replaceMediaSection(n,d.mid):this._addMediaSection(n)}}disableMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);this._mediaSections[t].disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);const i=this._mediaSections[t];if(e===this._firstMid)return d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e);i.close(),this._regenerateBundleMids()}planBStopReceiving({mid:e,offerRtpParameters:t}){const i=this._midToIndex.get(e);if(void 0===i)throw new Error(`no media section found with mid '${e}'`);const s=this._mediaSections[i];s.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(s)}sendSctpAssociation({offerMediaObject:e}){const t=new r.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new r.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,s.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const i=this._midToIndex.get(t);if(void 0===i)throw new Error(`no media section found for reuseMid '${t}'`);const s=this._mediaSections[i];this._mediaSections[i]=e,this._midToIndex.delete(s.mid),this._midToIndex.set(e.mid,i),this._sdpObject.media[i]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}}exports.RemoteSdp=n;
},{"sdp-transform":"CfIM","../../Logger":"andi","./MediaSection":"SdHv"}],"LIqw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=void 0;const e=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function r(r){const s=e.exec(r||"");return s?{spatialLayers:Number(s[1]),temporalLayers:Number(s[2])}:{spatialLayers:1,temporalLayers:1}}exports.parse=r;
},{}],"YvS6":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(null!=s)for(var a in s)"default"!==a&&Object.hasOwnProperty.call(s,a)&&e(i,s,a);return t(i,s),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome74=void 0;const i=s(require("sdp-transform")),a=require("../Logger"),r=s(require("../utils")),c=s(require("../ortc")),n=s(require("./sdp/commonUtils")),o=s(require("./sdp/unifiedPlanUtils")),d=require("./HandlerInterface"),p=require("./sdp/RemoteSdp"),l=require("../scalabilityModes"),h=new a.Logger("Chrome74"),m={OS:1024,MIS:1024};class g extends d.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Chrome74"}close(){if(h.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const a=await e.createOffer();try{e.close()}catch(t){}const r=i.parse(a.sdp);return n.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(s){}throw t}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:r,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:l}){h.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",l),video:c.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",l),video:c.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(Object.assign({iceServers:r||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){h.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(h.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:a}){this._assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((e,t)=>{e.rid=`r${t}`});const d=r.clone(this._sendingRtpParametersByKind[e.kind],{});d.codecs=c.reduceCodecs(d.codecs,a);const p=r.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});p.codecs=c.reduceCodecs(p.codecs,a);const m=this._remoteSdp.getNextMediaSectionIdx(),g=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let u,f=await this._pc.createOffer(),_=i.parse(f.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:_});let S=!1;const R=l.parse((t||[{}])[0].scalabilityMode);t&&1===t.length&&R.spatialLayers>1&&"video/vp9"===d.codecs[0].mimeType.toLowerCase()&&(h.debug("send() | enabling legacy simulcast for VP9 SVC"),S=!0,u=(_=i.parse(f.sdp)).media[m.idx],o.addLegacySimulcast({offerMediaObject:u,numStreams:R.spatialLayers}),f={type:"offer",sdp:i.write(_)}),h.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const w=g.mid;if(d.mid=w,u=(_=i.parse(this._pc.localDescription.sdp)).media[m.idx],d.rtcp.cname=n.getCname({offerMediaObject:u}),t)if(1===t.length){let e=o.getRtpEncodings({offerMediaObject:u});Object.assign(e[0],t[0]),S&&(e=[e[0]]),d.encodings=e}else d.encodings=t;else d.encodings=o.getRtpEncodings({offerMediaObject:u});if(d.encodings.length>1&&("video/vp8"===d.codecs[0].mimeType.toLowerCase()||"video/h264"===d.codecs[0].mimeType.toLowerCase()))for(const i of d.encodings)i.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:m.reuseMid,offerRtpParameters:d,answerRtpParameters:p,codecOptions:s,extmapAllowMixed:!0});const v={type:"answer",sdp:this._remoteSdp.getSdp()};return h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(w,g),{localId:w,rtpParameters:d,rtpSender:g.sender}}async stopSending(e){this._assertSendDirection(),h.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const s=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this._assertSendDirection(),t?h.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):h.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const i=s.sender.getParameters();i.encodings.forEach((e,s)=>{e.active=s<=t}),await s.sender.setParameters(i)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const i=s.sender.getParameters();i.encodings.forEach((e,s)=>{i.encodings[s]=Object.assign(Object.assign({},e),t)}),await s.sender.setParameters(i)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:a,protocol:r,priority:c}){this._assertSendDirection();const n={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:r,priority:c};h.debug("sendDataChannel() [options:%o]",n);const o=this._pc.createDataChannel(a,n);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=i.parse(e.sdp),s=t.media.find(e=>"application"===e.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:s});const a={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:n.id,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:s}){this._assertRecvDirection(),h.debug("receive() [trackId:%s, kind:%s]",e,t);const a=s.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:s,streamId:s.rtcp.cname,trackId:e});const r={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let c=await this._pc.createAnswer();const o=i.parse(c.sdp),d=o.media.find(e=>String(e.mid)===a);n.applyCodecParameters({offerRtpParameters:s,answerMediaObject:d}),c={type:"answer",sdp:i.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const p=this._pc.getTransceivers().find(e=>e.mid===a);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,p),{localId:a,track:p.receiver.track,rtpReceiver:p.receiver}}async stopReceiving(e){this._assertRecvDirection(),h.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const s={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this._assertRecvDirection();const{streamId:a,ordered:r,maxPacketLifeTime:c,maxRetransmits:n}=e,o={negotiated:!0,id:a,ordered:r,maxPacketLifeTime:c,maxRetransmits:n,protocol:s};h.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=i.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=i.parse(this._pc.localDescription.sdp));const s=n.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:s}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Chrome74=g;
},{"sdp-transform":"CfIM","../Logger":"andi","../utils":"fnp2","../ortc":"y0TR","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./HandlerInterface":"JfyM","./sdp/RemoteSdp":"vZFf","../scalabilityModes":"LIqw"}],"fEjk":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(null!=s)for(var a in s)"default"!==a&&Object.hasOwnProperty.call(s,a)&&e(i,s,a);return t(i,s),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome70=void 0;const i=s(require("sdp-transform")),a=require("../Logger"),r=s(require("../utils")),n=s(require("../ortc")),c=s(require("./sdp/commonUtils")),o=s(require("./sdp/unifiedPlanUtils")),d=require("./HandlerInterface"),p=require("./sdp/RemoteSdp"),l=require("../scalabilityModes"),m=new a.Logger("Chrome70"),h={OS:1024,MIS:1024};class g extends d.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Chrome70"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const a=await e.createOffer();try{e.close()}catch(t){}const r=i.parse(a.sdp);return c.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(s){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:r,iceTransportPolicy:c,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:l}){m.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:n.getSendingRtpParameters("audio",l),video:n.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:n.getSendingRemoteRtpParameters("audio",l),video:n.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(Object.assign({iceServers:r||[],iceTransportPolicy:c||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:a}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const d=r.clone(this._sendingRtpParametersByKind[e.kind],{});d.codecs=n.reduceCodecs(d.codecs,a);const p=r.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});p.codecs=n.reduceCodecs(p.codecs,a);const h=this._remoteSdp.getNextMediaSectionIdx(),g=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let u,f=await this._pc.createOffer(),_=i.parse(f.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:_}),t&&t.length>1&&(m.debug("send() | enabling legacy simulcast"),u=(_=i.parse(f.sdp)).media[h.idx],o.addLegacySimulcast({offerMediaObject:u,numStreams:t.length}),f={type:"offer",sdp:i.write(_)});let S=!1;const R=l.parse((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&R.spatialLayers>1&&"video/vp9"===d.codecs[0].mimeType.toLowerCase()&&(m.debug("send() | enabling legacy simulcast for VP9 SVC"),S=!0,u=(_=i.parse(f.sdp)).media[h.idx],o.addLegacySimulcast({offerMediaObject:u,numStreams:R.spatialLayers}),f={type:"offer",sdp:i.write(_)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f),t){m.debug("send() | applying given encodings");const e=g.sender.getParameters();for(let s=0;s<(e.encodings||[]).length;++s){const i=e.encodings[s],a=t[s];if(!a)break;e.encodings[s]=Object.assign(i,a)}await g.sender.setParameters(e)}const w=g.mid;if(d.mid=w,u=(_=i.parse(this._pc.localDescription.sdp)).media[h.idx],d.rtcp.cname=c.getCname({offerMediaObject:u}),d.encodings=o.getRtpEncodings({offerMediaObject:u}),t)for(let i=0;i<d.encodings.length;++i)t[i]&&Object.assign(d.encodings[i],t[i]);if(S&&(d.encodings=[d.encodings[0]]),d.encodings.length>1&&("video/vp8"===d.codecs[0].mimeType.toLowerCase()||"video/h264"===d.codecs[0].mimeType.toLowerCase()))for(const i of d.encodings)i.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:u,reuseMid:h.reuseMid,offerRtpParameters:d,answerRtpParameters:p,codecOptions:s});const b={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.set(w,g),{localId:w,rtpParameters:d,rtpSender:g.sender}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const s=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const i=s.sender.getParameters();i.encodings.forEach((e,s)=>{e.active=s<=t}),await s.sender.setParameters(i)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const i=s.sender.getParameters();i.encodings.forEach((e,s)=>{i.encodings[s]=Object.assign(Object.assign({},e),t)}),await s.sender.setParameters(i)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:a,protocol:r,priority:n}){this._assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:s,protocol:r,priority:n};m.debug("sendDataChannel() [options:%o]",c);const o=this._pc.createDataChannel(a,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=i.parse(e.sdp),s=t.media.find(e=>"application"===e.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:s});const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:s}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const a=s.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:s,streamId:s.rtcp.cname,trackId:e});const r={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let n=await this._pc.createAnswer();const o=i.parse(n.sdp),d=o.media.find(e=>String(e.mid)===a);c.applyCodecParameters({offerRtpParameters:s,answerMediaObject:d}),n={type:"answer",sdp:i.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);const p=this._pc.getTransceivers().find(e=>e.mid===a);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,p),{localId:a,track:p.receiver.track,rtpReceiver:p.receiver}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const s={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this._assertRecvDirection();const{streamId:a,ordered:r,maxPacketLifeTime:n,maxRetransmits:c}=e,o={negotiated:!0,id:a,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:c,protocol:s};m.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=i.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=i.parse(this._pc.localDescription.sdp));const s=c.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:s}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Chrome70=g;
},{"sdp-transform":"CfIM","../Logger":"andi","../utils":"fnp2","../ortc":"y0TR","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./HandlerInterface":"JfyM","./sdp/RemoteSdp":"vZFf","../scalabilityModes":"LIqw"}],"Upxu":[function(require,module,exports) {
"use strict";function s({offerMediaObject:s,track:t}){let r;const e=new Set;for(const o of s.ssrcs||[]){if("msid"!==o.attribute)continue;if(o.value.split(" ")[1]===t.id){const s=o.id;e.add(s),r||(r=s)}}if(0===e.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const i=new Map;for(const o of s.ssrcGroups||[]){if("FID"!==o.semantics)continue;let[s,t]=o.ssrcs.split(/\s+/);s=Number(s),t=Number(t),e.has(s)&&(e.delete(s),e.delete(t),i.set(s,t))}for(const o of e)i.set(o,null);const n=[];for(const[o,c]of i){const s={ssrc:o};c&&(s.rtx={ssrc:c}),n.push(s)}return n}function t({offerMediaObject:s,track:t,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");let e,i,n;if(!(s.ssrcs||[]).find(s=>{if("msid"!==s.attribute)return!1;return s.value.split(" ")[1]===t.id&&(e=s.id,n=s.value.split(" ")[0],!0)}))throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(s.ssrcGroups||[]).some(s=>{if("FID"!==s.semantics)return!1;const t=s.ssrcs.split(/\s+/);return Number(t[0])===e&&(i=Number(t[1]),!0)});const o=s.ssrcs.find(s=>"cname"===s.attribute&&s.id===e);if(!o)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const c=o.value,u=[],a=[];for(let d=0;d<r;++d)u.push(e+d),i&&a.push(i+d);s.ssrcGroups=s.ssrcGroups||[],s.ssrcs=s.ssrcs||[],s.ssrcGroups.push({semantics:"SIM",ssrcs:u.join(" ")});for(let d=0;d<u.length;++d){const r=u[d];s.ssrcs.push({id:r,attribute:"cname",value:c}),s.ssrcs.push({id:r,attribute:"msid",value:`${n} ${t.id}`})}for(let d=0;d<a.length;++d){const r=u[d],e=a[d];s.ssrcs.push({id:e,attribute:"cname",value:c}),s.ssrcs.push({id:e,attribute:"msid",value:`${n} ${t.id}`}),s.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${e}`})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addLegacySimulcast=exports.getRtpEncodings=void 0,exports.getRtpEncodings=s,exports.addLegacySimulcast=t;
},{}],"RFT0":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,a,s){void 0===s&&(s=a),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,s){void 0===s&&(s=a),e[s]=t[a]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var s={};if(null!=a)for(var i in a)"default"!==i&&Object.hasOwnProperty.call(a,i)&&e(s,a,i);return t(s,a),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome67=void 0;const s=a(require("sdp-transform")),i=require("../Logger"),r=a(require("../utils")),n=a(require("../ortc")),c=a(require("./sdp/commonUtils")),o=a(require("./sdp/planBUtils")),d=require("./HandlerInterface"),p=require("./sdp/RemoteSdp"),l=new i.Logger("Chrome67"),h={OS:1024,MIS:1024};class m extends d.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new m}get name(){return"Chrome67"}close(){if(l.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const i=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(t){}const r=s.parse(i.sdp);return c.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(a){}throw t}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:a,dtlsParameters:s,sctpParameters:i,iceServers:r,iceTransportPolicy:c,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:h}){l.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:a,dtlsParameters:s,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:n.getSendingRtpParameters("audio",h),video:n.getSendingRtpParameters("video",h)},this._sendingRemoteRtpParametersByKind={audio:n.getSendingRemoteRtpParameters("audio",h),video:n.getSendingRemoteRtpParameters("video",h)},this._pc=new RTCPeerConnection(Object.assign({iceServers:r||[],iceTransportPolicy:c||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:a,codec:i}){this._assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&l.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let d,p=await this._pc.createOffer(),h=s.parse(p.sdp);const m=r.clone(this._sendingRtpParametersByKind[e.kind],{});m.codecs=n.reduceCodecs(m.codecs);const g=r.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(g.codecs=n.reduceCodecs(g.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:h}),"video"===e.kind&&t&&t.length>1&&(l.debug("send() | enabling simulcast"),d=(h=s.parse(p.sdp)).media.find(e=>"video"===e.type),o.addLegacySimulcast({offerMediaObject:d,track:e,numStreams:t.length}),p={type:"offer",sdp:s.write(h)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),d=(h=s.parse(this._pc.localDescription.sdp)).media.find(t=>t.type===e.kind),m.rtcp.cname=c.getCname({offerMediaObject:d}),m.encodings=o.getRtpEncodings({offerMediaObject:d,track:e}),t)for(let s=0;s<m.encodings.length;++s)t[s]&&Object.assign(m.encodings[s],t[s]);if(m.encodings.length>1&&"video/vp8"===m.codecs[0].mimeType.toLowerCase())for(const s of m.encodings)s.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:m,answerRtpParameters:g,codecOptions:a});const S={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S);const _=String(this._nextSendLocalId);this._nextSendLocalId++;const f=this._pc.getSenders().find(t=>t.track===e);return this._mapSendLocalIdRtpSender.set(_,f),{localId:_,rtpParameters:m,rtpSender:f}}async stopSending(e){this._assertSendDirection(),l.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a);try{await this._pc.setLocalDescription(a)}catch(i){if(0===this._sendStream.getTracks().length)return void l.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());throw i}if("stable"===this._pc.signalingState)return;const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){this._assertSendDirection(),t?l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):l.debug("replaceTrack() [localId:%s, no track]",e);const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");const s=a.track;await a.replaceTrack(t),s&&this._sendStream.removeTrack(s),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");const s=a.getParameters();s.encodings.forEach((e,a)=>{e.active=a<=t}),await a.setParameters(s)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");const s=a.getParameters();s.encodings.forEach((e,a)=>{s.encodings[a]=Object.assign(Object.assign({},e),t)}),await a.setParameters(s)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:i,protocol:r,priority:n}){this._assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:a,protocol:r,priority:n};l.debug("sendDataChannel() [options:%o]",c);const o=this._pc.createDataChannel(i,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const i={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:a}){this._assertRecvDirection(),l.debug("receive() [trackId:%s, kind:%s]",e,t);const i=e,r=t;this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let o=await this._pc.createAnswer();const d=s.parse(o.sdp),p=d.media.find(e=>String(e.mid)===r);c.applyCodecParameters({offerRtpParameters:a,answerMediaObject:p}),o={type:"answer",sdp:s.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const h=this._pc.getReceivers().find(e=>e.track&&e.track.id===i);if(!h)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(i,{mid:r,rtpParameters:a,rtpReceiver:h}),{localId:i,track:h.track,rtpReceiver:h}}async stopReceiving(e){this._assertRecvDirection(),l.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:a}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:a});const s={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){this._assertRecvDirection();const{streamId:i,ordered:r,maxPacketLifeTime:n,maxRetransmits:c}=e,o={negotiated:!0,id:i,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:c,protocol:a};l.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const a=c.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Chrome67=m;
},{"sdp-transform":"CfIM","../Logger":"andi","../utils":"fnp2","../ortc":"y0TR","./sdp/commonUtils":"p5WR","./sdp/planBUtils":"Upxu","./HandlerInterface":"JfyM","./sdp/RemoteSdp":"vZFf"}],"vy33":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var i={};if(null!=a)for(var s in a)"default"!==s&&Object.hasOwnProperty.call(a,s)&&e(i,a,s);return t(i,a),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome55=void 0;const i=a(require("sdp-transform")),s=require("../Logger"),r=require("../errors"),n=a(require("../utils")),c=a(require("../ortc")),o=a(require("./sdp/commonUtils")),d=a(require("./sdp/planBUtils")),p=require("./HandlerInterface"),l=require("./sdp/RemoteSdp"),h=new s.Logger("Chrome55"),m={OS:1024,MIS:1024};class g extends p.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Chrome55"}close(){if(h.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const s=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(t){}const r=i.parse(s.sdp);return o.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(a){}throw t}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:a,dtlsParameters:i,sctpParameters:s,iceServers:r,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){h.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:a,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",p),video:c.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",p),video:c.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:r||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){h.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(h.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:a,codec:s}){this._assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),s&&h.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let r,p=await this._pc.createOffer(),l=i.parse(p.sdp);const m=n.clone(this._sendingRtpParametersByKind[e.kind],{});m.codecs=c.reduceCodecs(m.codecs);const g=n.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(g.codecs=c.reduceCodecs(g.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),"video"===e.kind&&t&&t.length>1&&(h.debug("send() | enabling simulcast"),r=(l=i.parse(p.sdp)).media.find(e=>"video"===e.type),d.addLegacySimulcast({offerMediaObject:r,track:e,numStreams:t.length}),p={type:"offer",sdp:i.write(l)}),h.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),r=(l=i.parse(this._pc.localDescription.sdp)).media.find(t=>t.type===e.kind),m.rtcp.cname=o.getCname({offerMediaObject:r}),m.encodings=d.getRtpEncodings({offerMediaObject:r,track:e}),t)for(let i=0;i<m.encodings.length;++i)t[i]&&Object.assign(m.encodings[i],t[i]);if(m.encodings.length>1&&"video/vp8"===m.codecs[0].mimeType.toLowerCase())for(const i of m.encodings)i.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:r,offerRtpParameters:m,answerRtpParameters:g,codecOptions:a});const _={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);const f=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(f,e),{localId:f,rtpParameters:m}}async stopSending(e){this._assertSendDirection(),h.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const a=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a);try{await this._pc.setLocalDescription(a)}catch(s){if(0===this._sendStream.getTracks().length)return void h.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());throw s}if("stable"===this._pc.signalingState)return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){throw new r.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new r.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new r.UnsupportedError("not supported")}async getSenderStats(e){throw new r.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:r,priority:n}){this._assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:a,protocol:r,priority:n};h.debug("sendDataChannel() [options:%o]",c);const o=this._pc.createDataChannel(s,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=i.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:a}){this._assertRecvDirection(),h.debug("receive() [trackId:%s, kind:%s]",e,t);const s=e,r=t,n=a.rtcp.cname;this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:a,streamId:n,trackId:e});const c={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let d=await this._pc.createAnswer();const p=i.parse(d.sdp),l=p.media.find(e=>String(e.mid)===r);o.applyCodecParameters({offerRtpParameters:a,answerMediaObject:l}),d={type:"answer",sdp:i.write(p)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:p}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);const m=this._pc.getRemoteStreams().find(e=>e.id===n).getTrackById(s);if(!m)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(s,{mid:r,rtpParameters:a}),{localId:s,track:m}}async stopReceiving(e){this._assertRecvDirection(),h.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:a}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:a});const i={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const s=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){throw new r.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){this._assertRecvDirection();const{streamId:s,ordered:r,maxPacketLifeTime:n,maxRetransmits:c}=e,o={negotiated:!0,id:s,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:c,protocol:a};h.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=i.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=i.parse(this._pc.localDescription.sdp));const a=o.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Chrome55=g;
},{"sdp-transform":"CfIM","../Logger":"andi","../errors":"hNUz","../utils":"fnp2","../ortc":"y0TR","./sdp/commonUtils":"p5WR","./sdp/planBUtils":"Upxu","./HandlerInterface":"JfyM","./sdp/RemoteSdp":"vZFf"}],"rkz5":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(null!=s)for(var a in s)"default"!==a&&Object.hasOwnProperty.call(s,a)&&e(i,s,a);return t(i,s),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Firefox60=void 0;const i=s(require("sdp-transform")),a=require("../Logger"),r=require("../errors"),c=s(require("../utils")),n=s(require("../ortc")),o=s(require("./sdp/commonUtils")),d=s(require("./sdp/unifiedPlanUtils")),p=require("./HandlerInterface"),l=require("./sdp/RemoteSdp"),h=new a.Logger("Firefox60"),m={OS:16,MIS:2048};class g extends p.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Firefox60"}close(){if(h.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const s=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const c=e.addTransceiver(s,{direction:"sendrecv"}),n=c.sender.getParameters(),d=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];n.encodings=d,await c.sender.setParameters(n);const p=await e.createOffer();try{t.remove()}catch(a){}try{s.stop()}catch(a){}try{e.close()}catch(a){}const l=i.parse(p.sdp);return o.extractRtpCapabilities({sdpObject:l})}catch(a){try{t.remove()}catch(r){}try{s.stop()}catch(r){}try{e.close()}catch(r){}throw a}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:r,iceTransportPolicy:c,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){h.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:n.getSendingRtpParameters("audio",p),video:n.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:n.getSendingRemoteRtpParameters("audio",p),video:n.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:r||[],iceTransportPolicy:c||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){throw new r.UnsupportedError("not supported")}async restartIce(e){if(h.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:a}){this._assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=c.clone(t,[])).length>1&&(t.forEach((e,t)=>{e.rid=`r${t}`}),t.reverse());const r=c.clone(this._sendingRtpParametersByKind[e.kind],{});r.codecs=n.reduceCodecs(r.codecs,a);const p=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});p.codecs=n.reduceCodecs(p.codecs,a);const l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const e=l.sender.getParameters();e.encodings=t,await l.sender.setParameters(e)}const m=await this._pc.createOffer();let g=i.parse(m.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:g}),h.debug("send() | calling pc.setLocalDescription() [offer:%o]",m),await this._pc.setLocalDescription(m);const f=l.mid;r.mid=f;const u=(g=i.parse(this._pc.localDescription.sdp)).media[g.media.length-1];if(r.rtcp.cname=o.getCname({offerMediaObject:u}),t)if(1===t.length){const e=d.getRtpEncodings({offerMediaObject:u});Object.assign(e[0],t[0]),r.encodings=e}else r.encodings=t.reverse();else r.encodings=d.getRtpEncodings({offerMediaObject:u});if(r.encodings.length>1&&("video/vp8"===r.codecs[0].mimeType.toLowerCase()||"video/h264"===r.codecs[0].mimeType.toLowerCase()))for(const i of r.encodings)i.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:u,offerRtpParameters:r,answerRtpParameters:p,codecOptions:s,extmapAllowMixed:!0});const _={type:"answer",sdp:this._remoteSdp.getSdp()};return h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(f,l),{localId:f,rtpParameters:r,rtpSender:l.sender}}async stopSending(e){h.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const s=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this._assertSendDirection(),t?h.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):h.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated transceiver not found");const i=s.sender.getParameters();t=i.encodings.length-1-t,i.encodings.forEach((e,s)=>{e.active=s>=t}),await s.sender.setParameters(i)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const i=s.sender.getParameters();i.encodings.forEach((e,s)=>{i.encodings[s]=Object.assign(Object.assign({},e),t)}),await s.sender.setParameters(i)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:a,protocol:r,priority:c}){this._assertSendDirection();const n={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:r,priority:c};h.debug("sendDataChannel() [options:%o]",n);const o=this._pc.createDataChannel(a,n);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=i.parse(e.sdp),s=t.media.find(e=>"application"===e.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:s});const a={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:n.id,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:s}){this._assertRecvDirection(),h.debug("receive() [trackId:%s, kind:%s]",e,t);const a=s.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:s,streamId:s.rtcp.cname,trackId:e});const r={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let c=await this._pc.createAnswer();const n=i.parse(c.sdp),d=n.media.find(e=>String(e.mid)===a);o.applyCodecParameters({offerRtpParameters:s,answerMediaObject:d}),c={type:"answer",sdp:i.write(n)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:n}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const p=this._pc.getTransceivers().find(e=>e.mid===a);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,p),{localId:a,track:p.receiver.track,rtpReceiver:p.receiver}}async stopReceiving(e){this._assertRecvDirection(),h.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const s={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this._assertRecvDirection();const{streamId:a,ordered:r,maxPacketLifeTime:c,maxRetransmits:n}=e,o={negotiated:!0,id:a,ordered:r,maxPacketLifeTime:c,maxRetransmits:n,protocol:s};h.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=i.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=i.parse(this._pc.localDescription.sdp));const s=o.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:s}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Firefox60=g;
},{"sdp-transform":"CfIM","../Logger":"andi","../errors":"hNUz","../utils":"fnp2","../ortc":"y0TR","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./HandlerInterface":"JfyM","./sdp/RemoteSdp":"vZFf"}],"Xquh":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(null!=s)for(var a in s)"default"!==a&&Object.hasOwnProperty.call(s,a)&&e(i,s,a);return t(i,s),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Safari12=void 0;const i=s(require("sdp-transform")),a=require("../Logger"),r=s(require("../utils")),c=s(require("../ortc")),n=s(require("./sdp/commonUtils")),o=s(require("./sdp/unifiedPlanUtils")),d=require("./HandlerInterface"),p=require("./sdp/RemoteSdp"),l=new a.Logger("Safari12"),h={OS:1024,MIS:1024};class m extends d.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new m}get name(){return"Safari12"}close(){if(l.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const a=await e.createOffer();try{e.close()}catch(t){}const r=i.parse(a.sdp);return n.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(s){}throw t}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a,iceServers:r,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:h}){l.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:s,dtlsParameters:i,sctpParameters:a}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",h),video:c.getSendingRtpParameters("video",h)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",h),video:c.getSendingRemoteRtpParameters("video",h)},this._pc=new RTCPeerConnection(Object.assign({iceServers:r||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:s,codec:a}){this._assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const d=r.clone(this._sendingRtpParametersByKind[e.kind],{});d.codecs=c.reduceCodecs(d.codecs,a);const p=r.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});p.codecs=c.reduceCodecs(p.codecs,a);const h=this._remoteSdp.getNextMediaSectionIdx(),m=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let g,f=await this._pc.createOffer(),u=i.parse(f.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:u}),t&&t.length>1&&(l.debug("send() | enabling legacy simulcast"),g=(u=i.parse(f.sdp)).media[h.idx],o.addLegacySimulcast({offerMediaObject:g,numStreams:t.length}),f={type:"offer",sdp:i.write(u)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const _=m.mid;if(d.mid=_,g=(u=i.parse(this._pc.localDescription.sdp)).media[h.idx],d.rtcp.cname=n.getCname({offerMediaObject:g}),d.encodings=o.getRtpEncodings({offerMediaObject:g}),t)for(let i=0;i<d.encodings.length;++i)t[i]&&Object.assign(d.encodings[i],t[i]);if(d.encodings.length>1&&("video/vp8"===d.codecs[0].mimeType.toLowerCase()||"video/h264"===d.codecs[0].mimeType.toLowerCase()))for(const i of d.encodings)i.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:g,reuseMid:h.reuseMid,offerRtpParameters:d,answerRtpParameters:p,codecOptions:s});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),this._mapMidTransceiver.set(_,m),{localId:_,rtpParameters:d,rtpSender:m.sender}}async stopSending(e){this._assertSendDirection(),l.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const s=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){this._assertSendDirection(),t?l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):l.debug("replaceTrack() [localId:%s, no track]",e);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");await s.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const i=s.sender.getParameters();i.encodings.forEach((e,s)=>{e.active=s<=t}),await s.sender.setParameters(i)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const s=this._mapMidTransceiver.get(e);if(!s)throw new Error("associated RTCRtpTransceiver not found");const i=s.sender.getParameters();i.encodings.forEach((e,s)=>{i.encodings[s]=Object.assign(Object.assign({},e),t)}),await s.sender.setParameters(i)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:s,label:a,protocol:r,priority:c}){this._assertSendDirection();const n={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:s,protocol:r,priority:c};l.debug("sendDataChannel() [options:%o]",n);const o=this._pc.createDataChannel(a,n);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=i.parse(e.sdp),s=t.media.find(e=>"application"===e.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:s});const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:n.id,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:s}){this._assertRecvDirection(),l.debug("receive() [trackId:%s, kind:%s]",e,t);const a=s.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:s,streamId:s.rtcp.cname,trackId:e});const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let c=await this._pc.createAnswer();const o=i.parse(c.sdp),d=o.media.find(e=>String(e.mid)===a);n.applyCodecParameters({offerRtpParameters:s,answerMediaObject:d}),c={type:"answer",sdp:i.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const p=this._pc.getTransceivers().find(e=>e.mid===a);if(!p)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,p),{localId:a,track:p.receiver.track,rtpReceiver:p.receiver}}async stopReceiving(e){this._assertRecvDirection(),l.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const s={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:s}){this._assertRecvDirection();const{streamId:a,ordered:r,maxPacketLifeTime:c,maxRetransmits:n}=e,o={negotiated:!0,id:a,ordered:r,maxPacketLifeTime:c,maxRetransmits:n,protocol:s};l.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=i.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=i.parse(this._pc.localDescription.sdp));const s=n.extractDtlsParameters({sdpObject:t});s.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:s}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Safari12=m;
},{"sdp-transform":"CfIM","../Logger":"andi","../utils":"fnp2","../ortc":"y0TR","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./HandlerInterface":"JfyM","./sdp/RemoteSdp":"vZFf"}],"wFon":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,a,s){void 0===s&&(s=a),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,s){void 0===s&&(s=a),e[s]=t[a]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var s={};if(null!=a)for(var i in a)"default"!==i&&Object.hasOwnProperty.call(a,i)&&e(s,a,i);return t(s,a),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Safari11=void 0;const s=a(require("sdp-transform")),i=require("../Logger"),r=a(require("../utils")),n=a(require("../ortc")),c=a(require("./sdp/commonUtils")),o=a(require("./sdp/planBUtils")),d=require("./HandlerInterface"),p=require("./sdp/RemoteSdp"),l=new i.Logger("Safari11"),h={OS:1024,MIS:1024};class m extends d.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new m}get name(){return"Safari11"}close(){if(l.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const i=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(t){}const r=s.parse(i.sdp);return c.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(a){}throw t}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:a,dtlsParameters:s,sctpParameters:i,iceServers:r,iceTransportPolicy:c,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:h}){l.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:a,dtlsParameters:s,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:n.getSendingRtpParameters("audio",h),video:n.getSendingRtpParameters("video",h)},this._sendingRemoteRtpParametersByKind={audio:n.getSendingRemoteRtpParameters("audio",h),video:n.getSendingRemoteRtpParameters("video",h)},this._pc=new RTCPeerConnection(Object.assign({iceServers:r||[],iceTransportPolicy:c||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){l.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(l.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:a,codec:i}){this._assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),i&&l.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let d,p=await this._pc.createOffer(),h=s.parse(p.sdp);const m=r.clone(this._sendingRtpParametersByKind[e.kind],{});m.codecs=n.reduceCodecs(m.codecs);const g=r.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(g.codecs=n.reduceCodecs(g.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:h}),"video"===e.kind&&t&&t.length>1&&(l.debug("send() | enabling simulcast"),d=(h=s.parse(p.sdp)).media.find(e=>"video"===e.type),o.addLegacySimulcast({offerMediaObject:d,track:e,numStreams:t.length}),p={type:"offer",sdp:s.write(h)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),d=(h=s.parse(this._pc.localDescription.sdp)).media.find(t=>t.type===e.kind),m.rtcp.cname=c.getCname({offerMediaObject:d}),m.encodings=o.getRtpEncodings({offerMediaObject:d,track:e}),t)for(let s=0;s<m.encodings.length;++s)t[s]&&Object.assign(m.encodings[s],t[s]);if(m.encodings.length>1&&"video/vp8"===m.codecs[0].mimeType.toLowerCase())for(const s of m.encodings)s.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:m,answerRtpParameters:g,codecOptions:a});const S={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S);const f=String(this._nextSendLocalId);this._nextSendLocalId++;const _=this._pc.getSenders().find(t=>t.track===e);return this._mapSendLocalIdRtpSender.set(f,_),{localId:f,rtpParameters:m,rtpSender:_}}async stopSending(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a);try{await this._pc.setLocalDescription(a)}catch(i){if(0===this._sendStream.getTracks().length)return void l.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());throw i}if("stable"===this._pc.signalingState)return;const s={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async replaceTrack(e,t){this._assertSendDirection(),t?l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):l.debug("replaceTrack() [localId:%s, no track]",e);const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");const s=a.track;await a.replaceTrack(t),s&&this._sendStream.removeTrack(s),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");const s=a.getParameters();s.encodings.forEach((e,a)=>{e.active=a<=t}),await a.setParameters(s)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const a=this._mapSendLocalIdRtpSender.get(e);if(!a)throw new Error("associated RTCRtpSender not found");const s=a.getParameters();s.encodings.forEach((e,a)=>{s.encodings[a]=Object.assign(Object.assign({},e),t)}),await a.setParameters(s)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:i,protocol:r,priority:n}){this._assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:a,protocol:r,priority:n};l.debug("sendDataChannel() [options:%o]",c);const o=this._pc.createDataChannel(i,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const i={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:a}){this._assertRecvDirection(),l.debug("receive() [trackId:%s, kind:%s]",e,t);const i=e,r=t;this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:a,streamId:a.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let o=await this._pc.createAnswer();const d=s.parse(o.sdp),p=d.media.find(e=>String(e.mid)===r);c.applyCodecParameters({offerRtpParameters:a,answerMediaObject:p}),o={type:"answer",sdp:s.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const h=this._pc.getReceivers().find(e=>e.track&&e.track.id===i);if(!h)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(i,{mid:r,rtpParameters:a,rtpReceiver:h}),{localId:i,track:h.track,rtpReceiver:h}}async stopReceiving(e){this._assertRecvDirection(),l.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:a}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:a});const s={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){this._assertRecvDirection();const{streamId:i,ordered:r,maxPacketLifeTime:n,maxRetransmits:c}=e,o={negotiated:!0,id:i,ordered:r,maxPacketLifeTime:n,maxRetransmits:c,protocol:a};l.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const a=c.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Safari11=m;
},{"sdp-transform":"CfIM","../Logger":"andi","../utils":"fnp2","../ortc":"y0TR","./sdp/commonUtils":"p5WR","./sdp/planBUtils":"Upxu","./HandlerInterface":"JfyM","./sdp/RemoteSdp":"vZFf"}],"pBRA":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var a={};if(null!=n)for(var i in n)"default"!==i&&Object.hasOwnProperty.call(n,i)&&e(a,n,i);return t(a,n),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mangleRtpParameters=exports.getCapabilities=void 0;const a=n(require("../../utils"));function i(){const e=RTCRtpReceiver.getCapabilities(),t=a.clone(e,{});for(const n of t.codecs){if(n.channels=n.numChannels,delete n.numChannels,n.mimeType=n.mimeType||`${n.kind}/${n.name}`,n.parameters){const e=n.parameters;e.apt&&(e.apt=Number(e.apt)),e["packetization-mode"]&&(e["packetization-mode"]=Number(e["packetization-mode"]))}for(const e of n.rtcpFeedback||[])e.parameter||(e.parameter="")}return t}function r(e){const t=a.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);for(const n of t.codecs)n.channels&&(n.numChannels=n.channels,delete n.channels),n.mimeType&&!n.name&&(n.name=n.mimeType.split("/")[1]),delete n.mimeType;return t}exports.getCapabilities=i,exports.mangleRtpParameters=r;
},{"../../utils":"fnp2"}],"H8eT":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var s={};if(null!=r)for(var a in r)"default"!==a&&Object.hasOwnProperty.call(r,a)&&e(s,r,a);return t(s,r),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Edge11=void 0;const s=require("../Logger"),a=require("../errors"),n=r(require("../utils")),i=r(require("../ortc")),c=r(require("./ortc/edgeUtils")),o=require("./HandlerInterface"),d=new s.Logger("Edge11");class p extends o.HandlerInterface{constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}static createFactory(){return()=>new p}get name(){return"Edge11"}close(){d.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const t of this._rtpSenders.values())try{t.stop()}catch(e){}for(const t of this._rtpReceivers.values())try{t.stop()}catch(e){}}async getNativeRtpCapabilities(){return d.debug("getNativeRtpCapabilities()"),c.getCapabilities()}async getNativeSctpCapabilities(){return d.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:s,sctpParameters:a,iceServers:c,iceTransportPolicy:o,additionalSettings:p,proprietaryConstraints:h,extendedRtpCapabilities:l}){d.debug("run()"),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",l),video:i.getSendingRtpParameters("video",l)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=s,this._cname=`CNAME-${n.generateRandomNumber()}`,this._setIceGatherer({iceServers:c,iceTransportPolicy:o}),this._setIceTransport(),this._setDtlsTransport()}async updateIceServers(e){throw new a.UnsupportedError("not supported")}async restartIce(e){if(d.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){d.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:s}){d.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),d.debug("send() | calling new RTCRtpSender()");const a=new RTCRtpSender(e,this._dtlsTransport),o=n.clone(this._sendingRtpParametersByKind[e.kind],{});o.codecs=i.reduceCodecs(o.codecs,s);const p=o.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType));t||(t=[{}]);for(const i of t)i.ssrc=n.generateRandomNumber(),p&&(i.rtx={ssrc:n.generateRandomNumber()});o.encodings=t,o.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const h=c.mangleRtpParameters(o);d.debug("send() | calling rtpSender.send() [params:%o]",h),await a.send(h);const l=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(l,a),{localId:l,rtpParameters:o,rtpSender:a}}async stopSending(e){d.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{d.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(r){throw d.warn("stopSending() | rtpSender.stop() failed:%o",r),r}}async replaceTrack(e,t){t?d.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):d.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){d.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const s=r.getParameters();s.encodings.forEach((e,r)=>{e.active=r<=t}),await r.setParameters(s)}async setRtpEncodingParameters(e,t){d.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const s=r.getParameters();s.encodings.forEach((e,r)=>{s.encodings[r]=Object.assign(Object.assign({},e),t)}),await r.setParameters(s)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new a.UnsupportedError("not implemented")}async receive({trackId:e,kind:t,rtpParameters:r}){d.debug("receive() [trackId:%s, kind:%s]",e,t),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),d.debug("receive() | calling new RTCRtpReceiver()");const s=new RTCRtpReceiver(this._dtlsTransport,t);s.addEventListener("error",e=>{d.error('rtpReceiver "error" event [event:%o]',e)});const a=c.mangleRtpParameters(r);d.debug("receive() | calling rtpReceiver.receive() [params:%o]",a),await s.receive(a);const n=e;return this._rtpReceivers.set(n,s),{localId:n,track:s.track,rtpReceiver:s}}async stopReceiving(e){d.debug("stopReceiving() [localId:%s]",e);const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{d.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(r){d.warn("stopReceiving() | rtpReceiver.stop() failed:%o",r)}}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new a.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",e=>{d.error('iceGatherer "error" event [event:%o]',e)});try{r.gather()}catch(s){d.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",s.toString())}this._iceGatherer=r}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("candidatepairchange",e=>{d.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{d.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{d.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",e=>{d.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){d.debug("_setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const r of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(r);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}exports.Edge11=p;
},{"../Logger":"andi","../errors":"hNUz","../utils":"fnp2","../ortc":"y0TR","./ortc/edgeUtils":"pBRA","./HandlerInterface":"JfyM"}],"DJ68":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var i={};if(null!=a)for(var s in a)"default"!==s&&Object.hasOwnProperty.call(a,s)&&e(i,a,s);return t(i,a),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReactNative=void 0;const i=a(require("sdp-transform")),s=require("../Logger"),r=require("../errors"),n=a(require("../utils")),c=a(require("../ortc")),o=a(require("./sdp/commonUtils")),d=a(require("./sdp/planBUtils")),p=require("./HandlerInterface"),l=require("./sdp/RemoteSdp"),m=new s.Logger("ReactNative"),h={OS:1024,MIS:1024};class g extends p.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"ReactNative"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const s=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(t){}const r=i.parse(s.sdp);return o.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(a){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:a,dtlsParameters:i,sctpParameters:s,iceServers:r,iceTransportPolicy:n,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:a,dtlsParameters:i,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",p),video:c.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",p),video:c.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:r||[],iceTransportPolicy:n||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),d),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:a,codec:s}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),s&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let r,p=await this._pc.createOffer(),l=i.parse(p.sdp);const h=n.clone(this._sendingRtpParametersByKind[e.kind],{});h.codecs=c.reduceCodecs(h.codecs);const g=n.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(g.codecs=c.reduceCodecs(g.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:l}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),r=(l=i.parse(p.sdp)).media.find(e=>"video"===e.type),d.addLegacySimulcast({offerMediaObject:r,track:e,numStreams:t.length}),p={type:"offer",sdp:i.write(l)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p),r=(l=i.parse(this._pc.localDescription.sdp)).media.find(t=>t.type===e.kind),h.rtcp.cname=o.getCname({offerMediaObject:r}),h.encodings=d.getRtpEncodings({offerMediaObject:r,track:e}),t)for(let i=0;i<h.encodings.length;++i)t[i]&&Object.assign(h.encodings[i],t[i]);if(h.encodings.length>1&&("video/vp8"===h.codecs[0].mimeType.toLowerCase()||"video/h264"===h.codecs[0].mimeType.toLowerCase()))for(const i of h.encodings)i.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:r,offerRtpParameters:h,answerRtpParameters:g,codecOptions:a});const _={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);const f=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(f,e),{localId:f,rtpParameters:h}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const a=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a);try{await this._pc.setLocalDescription(a)}catch(s){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());throw s}if("stable"===this._pc.signalingState)return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async replaceTrack(e,t){throw new r.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new r.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new r.UnsupportedError("not implemented")}async getSenderStats(e){throw new r.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:a,label:s,protocol:r,priority:n}){this._assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:a,protocol:r,priority:n};m.debug("sendDataChannel() [options:%o]",c);const o=this._pc.createDataChannel(s,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=i.parse(e.sdp),a=t.media.find(e=>"application"===e.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:a});const s={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:a}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const s=e,r=t;let c=a.rtcp.cname;m.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),c+=`-hack-${n.generateRandomNumber()}`,this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:a,streamId:c,trackId:e});const d={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);let p=await this._pc.createAnswer();const l=i.parse(p.sdp),h=l.media.find(e=>String(e.mid)===r);o.applyCodecParameters({offerRtpParameters:a,answerMediaObject:h}),p={type:"answer",sdp:i.write(l)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:l}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",p),await this._pc.setLocalDescription(p);const g=this._pc.getRemoteStreams().find(e=>e.id===c).getTrackById(s);if(!g)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(s,{mid:r,rtpParameters:a}),{localId:s,track:g}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:a}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:a});const i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const s=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",s),await this._pc.setLocalDescription(s)}async getReceiverStats(e){throw new r.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:a}){this._assertRecvDirection();const{streamId:s,ordered:r,maxPacketLifeTime:n,maxRetransmits:c}=e,o={negotiated:!0,id:s,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:c,protocol:a};m.debug("receiveDataChannel() [options:%o]",o);const d=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=i.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=i.parse(this._pc.localDescription.sdp));const a=o.extractDtlsParameters({sdpObject:t});a.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:a}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.ReactNative=g;
},{"sdp-transform":"CfIM","../Logger":"andi","../errors":"hNUz","../utils":"fnp2","../ortc":"y0TR","./sdp/commonUtils":"p5WR","./sdp/planBUtils":"Upxu","./HandlerInterface":"JfyM","./sdp/RemoteSdp":"vZFf"}],"kWtX":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var i={};if(null!=r)for(var a in r)"default"!==a&&Object.hasOwnProperty.call(r,a)&&e(i,r,a);return t(i,r),i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Device=exports.detectDevice=void 0;const a=i(require("bowser")),s=require("./Logger"),o=require("./EnhancedEventEmitter"),n=require("./errors"),d=r(require("./utils")),c=r(require("./ortc")),p=require("./Transport"),l=require("./handlers/Chrome74"),h=require("./handlers/Chrome70"),u=require("./handlers/Chrome67"),f=require("./handlers/Chrome55"),m=require("./handlers/Firefox60"),v=require("./handlers/Safari12"),b=require("./handlers/Safari11"),y=require("./handlers/Edge11"),C=require("./handlers/ReactNative"),g=new s.Logger("Device");function _(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void g.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(g.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)g.warn("this._detectDevice() | unknown device");else{const e=navigator.userAgent,t=a.default.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome74"}g.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}exports.detectDevice=_;class w{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new o.EnhancedEventEmitter,g.debug("constructor()"),r){if(g.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)g.debug("constructor() | handler given: %s",e);else{if(!(e=_()))throw new n.UnsupportedError("device not supported");g.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=l.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=h.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=u.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=f.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=m.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=v.Safari12.createFactory();break;case"Safari11":this._handlerFactory=b.Safari11.createFactory();break;case"Edge11":this._handlerFactory=y.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=C.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const i=this._handlerFactory();this._handlerName=i.name,i.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new n.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;g.debug("load() [routerRtpCapabilities:%o]",e),e=d.clone(e,void 0);try{if(this._loaded)throw new n.InvalidStateError("already loaded");c.validateRtpCapabilities(e),t=this._handlerFactory();const i=await t.getNativeRtpCapabilities();g.debug("load() | got native RTP capabilities:%o",i),c.validateRtpCapabilities(i),this._extendedRtpCapabilities=c.getExtendedRtpCapabilities(i,e),g.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=c.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=c.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=c.getRecvRtpCapabilities(this._extendedRtpCapabilities),c.validateRtpCapabilities(this._recvRtpCapabilities),g.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),g.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),c.validateSctpCapabilities(this._sctpCapabilities),g.debug("load() succeeded"),this._loaded=!0,t.close()}catch(r){throw t&&t.close(),r}}canProduce(e){if(!this._loaded)throw new n.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:a,iceServers:s,iceTransportPolicy:o,additionalSettings:n,proprietaryConstraints:d,appData:c={}}){return g.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:a,iceServers:s,iceTransportPolicy:o,additionalSettings:n,proprietaryConstraints:d,appData:c})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:a,iceServers:s,iceTransportPolicy:o,additionalSettings:n,proprietaryConstraints:d,appData:c={}}){return g.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:a,iceServers:s,iceTransportPolicy:o,additionalSettings:n,proprietaryConstraints:d,appData:c})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:a,sctpParameters:s,iceServers:o,iceTransportPolicy:d,additionalSettings:c,proprietaryConstraints:l,appData:h={}}){if(!this._loaded)throw new n.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(i))throw new TypeError("missing iceCandidates");if("object"!=typeof a)throw new TypeError("missing dtlsParameters");if(s&&"object"!=typeof s)throw new TypeError("wrong sctpParameters");if(h&&"object"!=typeof h)throw new TypeError("if given, appData must be an object");const u=new p.Transport({direction:e,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:a,sctpParameters:s,iceServers:o,iceTransportPolicy:d,additionalSettings:c,proprietaryConstraints:l,appData:h,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",u),u}}exports.Device=w;
},{"bowser":"JSid","./Logger":"andi","./EnhancedEventEmitter":"P3Oo","./errors":"hNUz","./utils":"fnp2","./ortc":"y0TR","./Transport":"BHpp","./handlers/Chrome74":"YvS6","./handlers/Chrome70":"fEjk","./handlers/Chrome67":"RFT0","./handlers/Chrome55":"vy33","./handlers/Firefox60":"rkz5","./handlers/Safari12":"Xquh","./handlers/Safari11":"wFon","./handlers/Edge11":"H8eT","./handlers/ReactNative":"DJ68"}],"Zn1c":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
},{}],"pJdj":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t),Object.defineProperty(e,o,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]}),r=this&&this.__exportStar||function(r,t){for(var o in r)"default"===o||t.hasOwnProperty(o)||e(t,r,o)};Object.defineProperty(exports,"__esModule",{value:!0}),r(require("./Device"),exports),r(require("./Transport"),exports),r(require("./Producer"),exports),r(require("./Consumer"),exports),r(require("./DataProducer"),exports),r(require("./DataConsumer"),exports),r(require("./RtpParameters"),exports),r(require("./SctpParameters"),exports),r(require("./handlers/HandlerInterface"),exports),r(require("./errors"),exports);
},{"./Device":"kWtX","./Transport":"BHpp","./Producer":"dKU8","./Consumer":"QQSC","./DataProducer":"Z0Ve","./DataConsumer":"g5am","./RtpParameters":"Zn1c","./SctpParameters":"Zn1c","./handlers/HandlerInterface":"JfyM","./errors":"hNUz"}],"CWXY":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var i={};if(null!=r)for(var n in r)"default"!==n&&Object.hasOwnProperty.call(r,n)&&e(i,r,n);return t(i,r),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.detectDevice=exports.Device=exports.version=exports.types=void 0;const i=require("./Device");Object.defineProperty(exports,"Device",{enumerable:!0,get:function(){return i.Device}}),Object.defineProperty(exports,"detectDevice",{enumerable:!0,get:function(){return i.detectDevice}});const n=r(require("./types"));exports.types=n,exports.version="3.6.29";var o=require("./scalabilityModes");Object.defineProperty(exports,"parseScalabilityMode",{enumerable:!0,get:function(){return o.parse}});
},{"./Device":"kWtX","./types":"pJdj","./scalabilityModes":"LIqw"}],"C6pA":[function(require,module,exports) {
module.exports={_from:"protoo-client",_id:"protoo-client@4.0.6",_inBundle:!1,_integrity:"sha512-ZqImkKHpeJhSlgvyI6QAfZNc/aXcCgmmocMx4S1w2lAaxXtckxxeDtcVNtkOISUWm/mbC+BrmYPXoGMkfhkKOQ==",_location:"/protoo-client",_phantomChildren:{},_requested:{type:"tag",registry:!0,raw:"protoo-client",name:"protoo-client",escapedName:"protoo-client",rawSpec:"",saveSpec:null,fetchSpec:"latest"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.6.tgz",_shasum:"02a89f997ee5a4f385dab7be938dda1a2c5158e4",_spec:"protoo-client",_where:"/Users/ojack/PROJECTS/flujos",author:{name:"Iñaki Baz Castillo",email:"ibc@aliax.net"},bugs:{url:"https://github.com/ibc/protoo/issues"},bundleDependencies:!1,dependencies:{debug:"^4.3.1",events:"^3.2.0",retry:"^0.12.0",websocket:"^1.0.33"},deprecated:!1,description:"protoo JavaScript client module",devDependencies:{eslint:"^5.16.0"},engines:{node:">=8.0.0"},homepage:"https://protoo.versatica.com",keywords:["nodejs","browser","websocket"],license:"MIT",main:"lib/index.js",name:"protoo-client",optionalDependencies:{websocket:"^1.0.33"},repository:{type:"git",url:"git+https://github.com/ibc/protoo.git"},scripts:{lint:"eslint -c .eslintrc.js lib"},version:"4.0.6"};
},{}],"UkIf":[function(require,module,exports) {
const r=require("debug"),o="protoo-client";class e{constructor(e){e?(this._debug=r(`${o}:${e}`),this._warn=r(`${o}:WARN:${e}`),this._error=r(`${o}:ERROR:${e}`)):(this._debug=r(o),this._warn=r(`${o}:WARN`),this._error=r(`${o}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}module.exports=e;
},{"debug":"jD9Y"}],"Aog5":[function(require,module,exports) {
const{EventEmitter:e}=require("events"),t=require("./Logger");class r extends e{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new t("EnhancedEventEmitter")}safeEmit(e,...t){try{this.emit(e,...t)}catch(r){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,r)}}async safeEmitAsPromise(e,...t){return new Promise((r,s)=>{this.safeEmit(e,...t,r,s)})}}module.exports=r;
},{"events":"dGdR","./Logger":"UkIf"}],"l708":[function(require,module,exports) {
exports.generateRandomNumber=function(){return Math.round(1e7*Math.random())};
},{}],"Isju":[function(require,module,exports) {
const e=require("./Logger"),{generateRandomNumber:r}=require("./utils"),i=new e("Message");class t{static parse(e){let r;const t={};try{r=JSON.parse(e)}catch(o){return void i.error("parse() | invalid JSON: %s",o)}if("object"==typeof r&&!Array.isArray(r)){if(r.request){if(t.request=!0,"string"!=typeof r.method)return void i.error("parse() | missing/invalid method field");if("number"!=typeof r.id)return void i.error("parse() | missing/invalid id field");t.id=r.id,t.method=r.method,t.data=r.data||{}}else if(r.response){if(t.response=!0,"number"!=typeof r.id)return void i.error("parse() | missing/invalid id field");t.id=r.id,r.ok?(t.ok=!0,t.data=r.data||{}):(t.ok=!1,t.errorCode=r.errorCode,t.errorReason=r.errorReason)}else{if(!r.notification)return void i.error("parse() | missing request/response field");if(t.notification=!0,"string"!=typeof r.method)return void i.error("parse() | missing/invalid method field");t.method=r.method,t.data=r.data||{}}return t}i.error("parse() | not an object")}static createRequest(e,i){return{request:!0,id:r(),method:e,data:i||{}}}static createSuccessResponse(e,r){return{response:!0,id:e.id,ok:!0,data:r||{}}}static createErrorResponse(e,r,i){return{response:!0,id:e.id,ok:!1,errorCode:r,errorReason:i}}static createNotification(e,r){return{notification:!0,method:e,data:r||{}}}}module.exports=t;
},{"./Logger":"UkIf","./utils":"l708"}],"PyVj":[function(require,module,exports) {
const e=require("./Logger"),t=require("./EnhancedEventEmitter"),s=require("./Message"),o=new e("Peer");class i extends t{constructor(e){super(o),o.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){o.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t){const o=s.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,o.id),await this._transport.send(o),new Promise((e,t)=>{const s=1500*(15+.1*this._sents.size),i={id:o.id,method:o.method,resolve:t=>{this._sents.delete(o.id)&&(clearTimeout(i.timer),e(t))},reject:e=>{this._sents.delete(o.id)&&(clearTimeout(i.timer),t(e))},timer:setTimeout(()=>{this._sents.delete(o.id)&&t(new Error("request timeout"))},s),close:()=>{clearTimeout(i.timer),t(new Error("peer closed"))}};this._sents.set(o.id,i)})}async notify(e,t){const o=s.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(o)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))});this._transport.on("open",()=>{this._closed||(o.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(o.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",e=>{this._closed||(o.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,o.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)})}_handleRequest(e){try{this.emit("request",e,t=>{const o=s.createSuccessResponse(e,t);this._transport.send(o).catch(()=>{})},(t,o)=>{t instanceof Error?(o=t.message,t=500):"number"==typeof t&&o instanceof Error&&(o=o.message);const i=s.createErrorResponse(e,t,o);this._transport.send(i).catch(()=>{})})}catch(t){const o=s.createErrorResponse(e,500,String(t));this._transport.send(o).catch(()=>{})}}_handleResponse(e){const t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{const s=new Error(e.errorReason);s.code=e.errorCode,t.reject(s)}else o.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}module.exports=i;
},{"./Logger":"UkIf","./EnhancedEventEmitter":"Aog5","./Message":"Isju"}],"NPI8":[function(require,module,exports) {
var t=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};module.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{return __global__||t()}finally{delete Object.prototype.__global__}}();
},{}],"VKXw":[function(require,module,exports) {
module.exports={_from:"websocket@^1.0.33",_id:"websocket@1.0.33",_inBundle:!1,_integrity:"sha512-XwNqM2rN5eh3G2CUQE3OHZj+0xfdH42+OFK6LdC2yqiC0YU8e5UK0nYre220T0IyyN031V/XOvtHvXozvJYFWA==",_location:"/websocket",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"websocket@^1.0.33",name:"websocket",escapedName:"websocket",rawSpec:"^1.0.33",saveSpec:null,fetchSpec:"^1.0.33"},_requiredBy:["/protoo-client"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.33.tgz",_shasum:"407f763fc58e74a3fa41ca3ae5d78d3f5e3b82a5",_spec:"websocket@^1.0.33",_where:"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client",author:{name:"Brian McKelvey",email:"theturtle32@gmail.com",url:"https://github.com/theturtle32"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},bundleDependencies:!1,config:{verbose:!1},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},deprecated:!1,description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.9.1"},directories:{lib:"./lib"},engines:{node:">=4.0.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",test:"tape test/unit/*.js"},version:"1.0.33"};
},{}],"CI7o":[function(require,module,exports) {
module.exports=require("../package.json").version;
},{"../package.json":"VKXw"}],"zPp5":[function(require,module,exports) {
var e;try{e=require("es5-ext/global")}catch(t){}finally{if(e||"undefined"==typeof window||(e=window),!e)throw new Error("Could not determine global this")}var n=e.WebSocket||e.MozWebSocket,o=require("./version");function r(e,o){return o?new n(e,o):new n(e)}n&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(r,e,{get:function(){return n[e]}})}),module.exports={w3cwebsocket:n?r:null,version:o};
},{"es5-ext/global":"NPI8","./version":"CI7o"}],"PqWU":[function(require,module,exports) {
function t(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}module.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var i=this._timeouts.shift();if(void 0===i){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),i=this._timeouts.shift()}var o=this,r=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},i);return this._options.unref&&r.unref(),!0},t.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var i=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){i._operationTimeoutCb()},i._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},t.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,i=0,o=0;o<this._errors.length;o++){var r=this._errors[o],s=r.message,n=(t[s]||0)+1;t[s]=n,n>=i&&(e=r,i=n)}return e};
},{}],"Wk2y":[function(require,module,exports) {
var r=require("./retry_operation");exports.operation=function(t){var e=exports.timeouts(t);return new r(e,{forever:t&&t.forever,unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},exports.timeouts=function(r){if(r instanceof Array)return[].concat(r);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var e in r)t[e]=r[e];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],n=0;n<t.retries;n++)o.push(this.createTimeout(n,t));return r&&r.forever&&!o.length&&o.push(this.createTimeout(n,t)),o.sort(function(r,t){return r-t}),o},exports.createTimeout=function(r,t){var e=t.randomize?Math.random()+1:1,o=Math.round(e*t.minTimeout*Math.pow(t.factor,r));return o=Math.min(o,t.maxTimeout)},exports.wrap=function(r,t,e){if(t instanceof Array&&(e=t,t=null),!e)for(var o in e=[],r)"function"==typeof r[o]&&e.push(o);for(var n=0;n<e.length;n++){var i=e[n],a=r[i];r[i]=function(e){var o=exports.operation(t),n=Array.prototype.slice.call(arguments,1),i=n.pop();n.push(function(r){o.retry(r)||(r&&(arguments[0]=o.mainError()),i.apply(this,arguments))}),o.attempt(function(){e.apply(r,n)})}.bind(r,a),r[i].options=t}};
},{"./retry_operation":"PqWU"}],"NFGJ":[function(require,module,exports) {
module.exports=require("./lib/retry");
},{"./lib/retry":"Wk2y"}],"ziqe":[function(require,module,exports) {
const e=require("websocket").w3cwebsocket,s=require("retry"),t=require("../Logger"),o=require("../EnhancedEventEmitter"),r=require("../Message"),i="protoo",n={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},c=new t("WebSocketTransport");class h extends o{constructor(e,s){super(c),c.debug("constructor() [url:%s, options:%o]",e,s),this._closed=!1,this._url=e,this._options=s||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){c.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){c.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(s){throw c.warn("send() failed:%o",s),s}}_runWebSocket(){const t=s.operation(this._options.retry||n);let o=!1;t.attempt(s=>{this._closed?t.stop():(c.debug("_runWebSocket() [currentAttempt:%s]",s),this._ws=new e(this._url,i,this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=(()=>{this._closed||(o=!0,this.safeEmit("open"))}),this._ws.onclose=(e=>{if(!this._closed){if(c.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',e.wasClean,e.code,e.reason),4e3!==e.code){if(o){if(t.stop(),this.safeEmit("disconnected"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit("failed",s),this._closed)return;if(t.retry(!0))return}this._closed=!0,this.safeEmit("close")}}),this._ws.onerror=(()=>{this._closed||c.error('WebSocket "error" event')}),this._ws.onmessage=(e=>{if(this._closed)return;const s=r.parse(e.data);s&&(0!==this.listenerCount("message")?this.safeEmit("message",s):c.error('no listeners for WebSocket "message" event, ignoring received message'))}))})}}module.exports=h;
},{"websocket":"zPp5","retry":"NFGJ","../Logger":"UkIf","../EnhancedEventEmitter":"Aog5","../Message":"Isju"}],"DLpz":[function(require,module,exports) {
const{version:e}=require("../package.json"),r=require("./Peer"),o=require("./transports/WebSocketTransport");exports.version=e,exports.Peer=r,exports.WebSocketTransport=o;
},{"../package.json":"C6pA","./Peer":"PyVj","./transports/WebSocketTransport":"ziqe"}],"NWXC":[function(require,module,exports) {
const{EventEmitter:e}=require("events"),{Device:r}=require("mediasoup-client"),{WebSocketTransport:t,Peer:s}=require("protoo-client");module.exports=class extends e{constructor(){super(),this.peer=null,this.sendTransport=null,this.recvTransport=null}join(e="ws://localhost:2345"){const r=new t(e);this.peer=new s(r),this.peer.on("open",this.onPeerOpen.bind(this)),this.peer.on("request",this.onPeerRequest.bind(this)),this.peer.on("notification",this.onPeerNotification.bind(this)),this.peer.on("failed",console.error),this.peer.on("disconnected",console.error),this.peer.on("close",console.error)}async sendAudio(e){const r=await this.sendTransport.produce({track:e});return r.on("trackended",async()=>{await this._closeProducer(r)}),r}async sendVideo(e){const r=await this.sendTransport.produce({track:e});return r.on("trackended",async()=>{await this._closeProducer(r)}),r}async onPeerOpen(){const e=new r,t=await this.peer.request("getRouterRtpCapabilities").catch(console.error);await e.load({routerRtpCapabilities:t}),await this._prepareSendTransport(e).catch(console.error),await this._prepareRecvTransport(e).catch(console.error);const s=await this.peer.request("join",{rtpCapabilities:e.rtpCapabilities});this.emit("@open",s)}async _prepareSendTransport(e){const r=await this.peer.request("createWebRtcTransport",{producing:!0,consuming:!1}).catch(console.error);this.sendTransport=e.createSendTransport(r),this.sendTransport.on("connect",({dtlsParameters:e},r,t)=>{this.peer.request("connectWebRtcTransport",{transportId:this.sendTransport.id,dtlsParameters:e}).then(r).catch(t)}),this.sendTransport.on("produce",async({kind:e,rtpParameters:r,appData:t},s,n)=>{try{const{id:a}=await this.peer.request("produce",{transportId:this.sendTransport.id,kind:e,rtpParameters:r,appData:t});s({id:a})}catch(o){n(o)}})}async _prepareRecvTransport(e){const r=await this.peer.request("createWebRtcTransport",{producing:!1,consuming:!0}).catch(console.error);this.recvTransport=e.createRecvTransport(r),this.recvTransport.on("connect",({dtlsParameters:e},r,t)=>{this.peer.request("connectWebRtcTransport",{transportId:this.recvTransport.id,dtlsParameters:e}).then(r).catch(t)})}async _closeProducer(e){e.close(),await this.peer.request("closeProducer",{producerId:e.id}).catch(console.error),this.emit("@producerClosed",{producerId:e.id})}onPeerRequest(e,r,t){switch(e.method){case"newConsumerOffer":r({accept:!0});break;case"newConsumer":this.recvTransport.consume(e.data).then(e=>{this.emit("@consumer",e),r()}).catch(t);break;default:r()}}onPeerNotification(e){this.emit("@"+e.method,e.data)}};
},{"events":"dGdR","mediasoup-client":"CWXY","protoo-client":"DLpz"}],"xLHE":[function(require,module,exports) {
const t=require("./room.js"),s=require("events");module.exports=class extends s{constructor({videoEl:s,server:e="ws://localhost:2345",streamKey:o="test"}){super(),this.room=new t,this.tracks={audio:null,video:null},this.isActive=!1;const r=`${e}/?stream=${o}`;console.log("connecting to",r),this.room.join(r),s||(s=document.createElement("video"),document.body.appendChild(s)),this.video=s,this.video.addEventListener("canplay",t=>{}),this.room.on("@consumer",async t=>{const{id:s,appData:{peerId:e},track:o}=t;this.addTrack(o,e,s)}),this.room.on("@consumerClosed",t=>{console.log(t),console.log(t.consumerId),this.removeTrack(t.consumerId)}),this.room.on("@producerClosed",({producerId:t})=>{console.log("producer closed")}),this.room.on("@peerClosed",({peerId:t})=>{})}addTrack(t,s,e){this.tracks[t.kind],this.tracks[t.kind]={track:t,peerId:s,consumerId:e},this.updateStream()}updateStream(){const t=new MediaStream;null!==this.tracks.audio&&t.addTrack(this.tracks.audio.track),null!==this.tracks.video&&t.addTrack(this.tracks.video.track),this.video.srcObject=t,this.isActive=!0,null===this.tracks.audio&&null===this.tracks.video&&(this.isActive=!1),this.emit("update",this.tracks)}removeTrack(t){null!==this.tracks.audio&&this.tracks.audio.consumerId===t&&(this.tracks.audio=null),null!==this.tracks.video&&this.tracks.video.consumerId===t&&(this.tracks.video=null),this.updateStream()}};
},{"./room.js":"NWXC","events":"dGdR"}],"Fszt":[function(require,module,exports) {
module.exports=r;var t={class:"className",for:"htmlFor","http-equiv":"httpEquiv"};function r(r){return function(e,n,o){for(var u in n)u in t&&(n[t[u]]=n[u],delete n[u]);return r(e,n,o)}}
},{}],"P8fc":[function(require,module,exports) {
var e=require("hyperscript-attribute-to-property"),t=0,n=1,r=2,s=3,h=4,l=5,i=6,o=7,f=8,p=9,u=10,a=11,g=12,c=13;function m(e){return e===p||e===u}module.exports=function(y,d){d||(d={});var b=d.concat||function(e,t){return String(e)+String(t)};return!1!==d.attrToProp&&(y=e(y)),function(e){for(var A=n,k="",F=arguments.length,L=[],S=0;S<e.length;S++)if(S<F-1){var x=arguments[S+1],M=O(e[S]),C=A;C===u&&(C=f),C===p&&(C=f),C===o&&(C=f),C===h&&(C=l),C===r?"/"===k?(M.push([r,"/",x]),k=""):M.push([r,x]):C===c&&d.comments?k+=String(x):C!==c&&M.push([t,C,x]),L.push.apply(L,M)}else L.push.apply(L,O(e[S]));var T=[null,{},[]],$=[[T,-1]];for(S=0;S<L.length;S++){var j=$[$.length-1][0],B=(M=L[S])[0];if(B===r&&/^\//.test(M[1])){var D=$[$.length-1][1];$.length>1&&($.pop(),$[$.length-1][0][2][D]=y(j[0],j[1],j[2].length?j[2]:void 0))}else if(B===r){var E=[M[1],{},[]];j[2].push(E),$.push([E,j[2].length-1])}else if(B===l||B===t&&M[1]===l){for(var P,R="";S<L.length;S++)if(L[S][0]===l)R=b(R,L[S][1]);else{if(L[S][0]!==t||L[S][1]!==l)break;if("object"!=typeof L[S][2]||R)R=b(R,L[S][2]);else for(P in L[S][2])L[S][2].hasOwnProperty(P)&&!j[1][P]&&(j[1][P]=L[S][2][P])}L[S][0]===a&&S++;for(var G=S;S<L.length;S++)if(L[S][0]===f||L[S][0]===l)j[1][R]?""===L[S][1]||(j[1][R]=b(j[1][R],L[S][1])):j[1][R]=w(L[S][1]);else{if(L[S][0]!==t||L[S][1]!==f&&L[S][1]!==l){!R.length||j[1][R]||S!==G||L[S][0]!==s&&L[S][0]!==g||(j[1][R]=R.toLowerCase()),L[S][0]===s&&S--;break}j[1][R]?""===L[S][2]||(j[1][R]=b(j[1][R],L[S][2])):j[1][R]=w(L[S][2])}}else if(B===l)j[1][M[1]]=!0;else if(B===t&&M[1]===l)j[1][M[2]]=!0;else if(B===s){if(v(j[0])&&$.length){D=$[$.length-1][1];$.pop(),$[$.length-1][0][2][D]=y(j[0],j[1],j[2].length?j[2]:void 0)}}else if(B===t&&M[1]===n)void 0===M[2]||null===M[2]?M[2]="":M[2]||(M[2]=b("",M[2])),Array.isArray(M[2][0])?j[2].push.apply(j[2],M[2]):j[2].push(M[2]);else if(B===n)j[2].push(M[1]);else if(B!==a&&B!==g)throw new Error("unhandled: "+B)}if(T[2].length>1&&/^\s*$/.test(T[2][0])&&T[2].shift(),T[2].length>2||2===T[2].length&&/\S/.test(T[2][1])){if(d.createFragment)return d.createFragment(T[2]);throw new Error("multiple root elements must be wrapped in an enclosing tag")}return Array.isArray(T[2][0])&&"string"==typeof T[2][0][0]&&Array.isArray(T[2][0][2])&&(T[2][0]=y(T[2][0][0],T[2][0][1],T[2][0][2])),T[2][0];function O(e){var t=[];A===o&&(A=h);for(var y=0;y<e.length;y++){var v=e.charAt(y);A===n&&"<"===v?(k.length&&t.push([n,k]),k="",A=r):">"!==v||m(A)||A===c?A===c&&/-$/.test(k)&&"-"===v?(d.comments&&t.push([f,k.substr(0,k.length-1)]),k="",A=n):A===r&&/^!--$/.test(k)?(d.comments&&t.push([r,k],[l,"comment"],[a]),k=v,A=c):A===n||A===c?k+=v:A===r&&"/"===v&&k.length||(A===r&&/\s/.test(v)?(k.length&&t.push([r,k]),k="",A=h):A===r?k+=v:A===h&&/[^\s"'=/]/.test(v)?(A=l,k=v):A===h&&/\s/.test(v)?(k.length&&t.push([l,k]),t.push([g])):A===l&&/\s/.test(v)?(t.push([l,k]),k="",A=i):A===l&&"="===v?(t.push([l,k],[a]),k="",A=o):A===l?k+=v:A!==i&&A!==h||"="!==v?A!==i&&A!==h||/\s/.test(v)?A===o&&'"'===v?A=u:A===o&&"'"===v?A=p:A===u&&'"'===v?(t.push([f,k],[g]),k="",A=h):A===p&&"'"===v?(t.push([f,k],[g]),k="",A=h):A!==o||/\s/.test(v)?A===f&&/\s/.test(v)?(t.push([f,k],[g]),k="",A=h):A!==f&&A!==p&&A!==u||(k+=v):(A=f,y--):(t.push([g]),/[\w-]/.test(v)?(k+=v,A=l):A=h):(t.push([a]),A=o)):(A===r&&k.length?t.push([r,k]):A===l?t.push([l,k]):A===f&&k.length&&t.push([f,k]),t.push([s]),k="",A=n)}return A===n&&k.length?(t.push([n,k]),k=""):A===f&&k.length?(t.push([f,k]),k=""):A===u&&k.length?(t.push([f,k]),k=""):A===p&&k.length?(t.push([f,k]),k=""):A===l&&(t.push([l,k]),k=""),t}};function w(e){return"function"==typeof e?e:"string"==typeof e?e:e&&"object"==typeof e?e:null==e?e:b("",e)}};var y=RegExp("^("+["area","base","basefont","bgsound","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr","!--","animate","animateTransform","circle","cursor","desc","ellipse","feBlend","feColorMatrix","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","font-face-format","font-face-name","font-face-uri","glyph","glyphRef","hkern","image","line","missing-glyph","mpath","path","polygon","polyline","rect","set","stop","tref","use","view","vkern"].join("|")+")(?:[.#][a-zA-Z0-9-￿_:-]+)*$");function v(e){return y.test(e)}
},{"hyperscript-attribute-to-property":"Fszt"}],"gPFH":[function(require,module,exports) {
"use strict";var e=/\n[\s]+$/,a=/^\n[\s]+/,r=/[\s]+$/,n=/^[\s]+/,o=/[\n\s]+/g,l=["a","abbr","b","bdi","bdo","br","cite","data","dfn","em","i","kbd","mark","q","rp","rt","rtc","ruby","s","amp","small","span","strong","sub","sup","time","u","var","wbr"],d=["code","pre","textarea"];module.exports=function p(t,i){if(Array.isArray(i))for(var c,s,f=t.nodeName.toLowerCase(),u=!1,m=0,b=i.length;m<b;m++){var x=i[m];if(Array.isArray(x))p(t,x);else{("number"==typeof x||"boolean"==typeof x||"function"==typeof x||x instanceof Date||x instanceof RegExp)&&(x=x.toString());var y=t.childNodes[t.childNodes.length-1];if("string"==typeof x)u=!0,y&&"#text"===y.nodeName?y.nodeValue+=x:(x=t.ownerDocument.createTextNode(x),t.appendChild(x),y=x),m===b-1&&(u=!1,-1===l.indexOf(f)&&-1===d.indexOf(f)?""===(c=y.nodeValue.replace(a,"").replace(r,"").replace(e,"").replace(o," "))?t.removeChild(y):y.nodeValue=c:-1===d.indexOf(f)&&(s=0===m?"":" ",c=y.nodeValue.replace(a,s).replace(n," ").replace(r,"").replace(e,"").replace(o," "),y.nodeValue=c));else if(x&&x.nodeType){u&&(u=!1,-1===l.indexOf(f)&&-1===d.indexOf(f)?""===(c=y.nodeValue.replace(a,"").replace(e," ").replace(o," "))?t.removeChild(y):y.nodeValue=c:-1===d.indexOf(f)&&(c=y.nodeValue.replace(n," ").replace(a,"").replace(e," ").replace(o," "),y.nodeValue=c));var V=x.nodeName;V&&(f=V.toLowerCase()),t.appendChild(x)}}}};
},{}],"yLdR":[function(require,module,exports) {
"use strict";module.exports=["svg","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"];
},{}],"YVSa":[function(require,module,exports) {
"use strict";module.exports=["async","autofocus","autoplay","checked","controls","default","defaultchecked","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","novalidate","open","playsinline","readonly","required","reversed","selected"];
},{}],"XElX":[function(require,module,exports) {
"use strict";module.exports=["indeterminate"];
},{}],"Ot7I":[function(require,module,exports) {
"use strict";var e=require("hyperx"),r=require("./append-child"),t=require("./svg-tags"),n=require("./bool-props"),a=require("./direct-props"),i="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xlink",l="!--";module.exports=function(c){function o(e,o,m){var u;-1!==t.indexOf(e)&&(o.namespace=i);var p=!1;o.namespace&&(p=o.namespace,delete o.namespace);var f=!1;if(o.is&&(f=o.is,delete o.is),p)u=f?c.createElementNS(p,e,{is:f}):c.createElementNS(p,e);else{if(e===l)return c.createComment(o.comment);u=f?c.createElement(e,{is:f}):c.createElement(e)}for(var d in o)if(o.hasOwnProperty(d)){var g=d.toLowerCase(),h=o[d];if("classname"===g&&(g="class",d="class"),"htmlFor"===d&&(d="for"),-1!==n.indexOf(g))if("true"===String(h))h=g;else if("false"===String(h))continue;"on"===g.slice(0,2)||-1!==a.indexOf(g)?u[d]=h:p?"xlink:href"===d?u.setAttributeNS(s,d,h):/^xmlns($|:)/i.test(d)||u.setAttributeNS(null,d,h):u.setAttribute(d,h)}return r(u,m),u}var m=e(o,{comments:!0,createFragment:function e(r){for(var t=c.createDocumentFragment(),n=0;n<r.length;n++)null!=r[n]&&(Array.isArray(r[n])?t.appendChild(e(r[n])):("string"==typeof r[n]&&(r[n]=c.createTextNode(r[n])),t.appendChild(r[n])));return t}});return m.default=m,m.createComment=o,m};
},{"hyperx":"P8fc","./append-child":"gPFH","./svg-tags":"yLdR","./bool-props":"YVSa","./direct-props":"XElX"}],"QR4u":[function(require,module,exports) {
module.exports=require("./dom")(document);
},{"./dom":"Ot7I"}],"asVN":[function(require,module,exports) {
const e=require("./lib/mediasoup-viewer.js"),t=require("nanohtml");function i({width:e=300,height:i=200}={},o=(()=>{})){const s=t`<video style="width:${e};height:${i};clip-path:circle(${i/2}px at ${e/2}px ${i/2}px)"></video>`;return s.autoplay=!0,s.addEventListener("loadeddata",o),s}module.exports=(()=>{let o=!1;const s="wss://mediasoup.tentacles.live:8000";if(!o){const d=i({},()=>{setTimeout(()=>{d.play()},600)}),l=i({},()=>{d.play()}),a=t`<div class="absolute right-0 top-0 fr">${d}${l}</div>`;document.body.appendChild(a);new e({videoEl:d,server:s,streamKey:"flujos"}),new e({videoEl:l,server:s,streamKey:"flujos2"});o=!0}});
},{"./lib/mediasoup-viewer.js":"xLHE","nanohtml":"QR4u"}],"sTPq":[function(require,module,exports) {
const o=require("nanohtml");module.exports=(()=>{const e=o`<canvas class="w-100 h-100"></canvas>`;e.width=window.innerWidth,e.height=window.innerHeight,document.body.appendChild(e);new Hydra({detectAudio:!1,canvas:e});speed=.5,osc(10,.03,1.2).color(1,.3,.6).add(osc(15,-.1).color(.1,.9,.3)).out(),src(o1).layer(src(o0).mask(osc(10,-.1).rotate(0,.1).modulate(osc(10).thresh(.8,.4)).kaleid(2).thresh(.9,0)),0).modulate(osc(20),-.004,1.02).modulate(src(o1).color(1,0),.1).contrast(1.1).blend(o0,()=>.5*Math.sin(.1*time)+.5).out(o1),render(o1)});
},{"nanohtml":"QR4u"}],"Focm":[function(require,module,exports) {
const initStreamingMedia=require("./init-media-sources.js"),initHydra=require("./init-hydra.js"),html=require("nanohtml"),flokURL="https://flok.clic.cf/s/NjUxMWM2MjUtOTFlZi00NzNiLWJhNTUtMzVhNWIwY2U0MmFm?layout=hydra,hydra&noHydra=1&bgOpacity=0",queryString=window.location.search,urlParams=new URLSearchParams(queryString),edit=urlParams.get("edit"),readOnly=1!=edit;initHydra();const intro=html`<div class="pa4 i f3"> <h1 class="f1 i"> flujos </h1>
    <p class="f3"> web_site_specific performance</p>
    <p class="f3">by Celeste Betancur and Olivia Jack </p>
    <div onclick=${start} class="pointer dim"> ${">>>"} enter ${"<<<<"} </div>
    </div>`,uiContainer=html`<div class="w-100 h-100 absolute top-0 left-0 overflow-y-auto">${intro}</div>`,editor=html`<div class="absolute mb5 bottom-0 left-0 w-100 skewY" style="height:40%">
<iframe src="${flokURL}${readOnly?"&readonly=1":""}" frameborder="0" class="w-100 h-100"></iframe>
</div>`;function start(){uiContainer.innerHTML="",uiContainer.appendChild(editor),initStreamingMedia()}window.addEventListener("message",function(event){event.data&&"evaluateCode"===event.data.cmd&&eval(event.data.args.body)}),document.body.appendChild(uiContainer);
},{"./init-media-sources.js":"asVN","./init-hydra.js":"sTPq","nanohtml":"QR4u"}]},{},["Focm"], null)
//# sourceMappingURL=/flujos.67c629da.js.map