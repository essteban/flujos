{"id":"xLHE","dependencies":[{"name":"/Users/ojack/PROJECTS/flujos/package.json","includedInParent":true,"mtime":1618339867251},{"name":"./room.js","loc":{"line":1,"column":21},"parent":"/Users/ojack/PROJECTS/flujos/lib/mediasoup-viewer.js","resolved":"/Users/ojack/PROJECTS/flujos/lib/room.js"},{"name":"events","loc":{"line":2,"column":29},"parent":"/Users/ojack/PROJECTS/flujos/lib/mediasoup-viewer.js","resolved":"/usr/local/lib/node_modules/parcel-bundler/node_modules/events/events.js"}],"generated":{"js":"const t=require(\"./room.js\"),s=require(\"events\");module.exports=class extends s{constructor({videoEl:s,server:e=\"ws://localhost:2345\",streamKey:o=\"test\"}){super(),this.room=new t,this.tracks={audio:null,video:null},this.isActive=!1;const r=`${e}/?stream=${o}`;console.log(\"connecting to\",r),this.room.join(r),s||(s=document.createElement(\"video\"),document.body.appendChild(s)),this.video=s,this.video.addEventListener(\"canplay\",t=>{}),this.room.on(\"@consumer\",async t=>{const{id:s,appData:{peerId:e},track:o}=t;this.addTrack(o,e,s)}),this.room.on(\"@consumerClosed\",t=>{console.log(t),console.log(t.consumerId),this.removeTrack(t.consumerId)}),this.room.on(\"@producerClosed\",({producerId:t})=>{console.log(\"producer closed\")}),this.room.on(\"@peerClosed\",({peerId:t})=>{})}addTrack(t,s,e){this.tracks[t.kind],this.tracks[t.kind]={track:t,peerId:s,consumerId:e},this.updateStream()}updateStream(){const t=new MediaStream;null!==this.tracks.audio&&t.addTrack(this.tracks.audio.track),null!==this.tracks.video&&t.addTrack(this.tracks.video.track),this.video.srcObject=t,this.isActive=!0,null===this.tracks.audio&&null===this.tracks.video&&(this.isActive=!1),this.emit(\"update\",this.tracks)}removeTrack(t){null!==this.tracks.audio&&this.tracks.audio.consumerId===t&&(this.tracks.audio=null),null!==this.tracks.video&&this.tracks.video.consumerId===t&&(this.tracks.video=null),this.updateStream()}};"},"sourceMaps":{"js":{"mappings":[{"source":"lib/mediasoup-viewer.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"lib/mediasoup-viewer.js","name":"Room","original":{"line":1,"column":6},"generated":{"line":1,"column":6}},{"source":"lib/mediasoup-viewer.js","name":"require","original":{"line":1,"column":13},"generated":{"line":1,"column":8}},{"source":"lib/mediasoup-viewer.js","original":{"line":1,"column":21},"generated":{"line":1,"column":16}},{"source":"lib/mediasoup-viewer.js","name":"EventEmitter","original":{"line":2,"column":6},"generated":{"line":1,"column":29}},{"source":"lib/mediasoup-viewer.js","name":"require","original":{"line":2,"column":21},"generated":{"line":1,"column":31}},{"source":"lib/mediasoup-viewer.js","original":{"line":2,"column":29},"generated":{"line":1,"column":39}},{"source":"lib/mediasoup-viewer.js","name":"module","original":{"line":4,"column":0},"generated":{"line":1,"column":49}},{"source":"lib/mediasoup-viewer.js","name":"exports","original":{"line":4,"column":7},"generated":{"line":1,"column":56}},{"source":"lib/mediasoup-viewer.js","original":{"line":4,"column":17},"generated":{"line":1,"column":64}},{"source":"lib/mediasoup-viewer.js","name":"EventEmitter","original":{"line":4,"column":38},"generated":{"line":1,"column":78}},{"source":"lib/mediasoup-viewer.js","name":"constructor","original":{"line":5,"column":2},"generated":{"line":1,"column":80}},{"source":"lib/mediasoup-viewer.js","original":{"line":5,"column":15},"generated":{"line":1,"column":93}},{"source":"lib/mediasoup-viewer.js","name":"videoEl","original":{"line":5,"column":17},"generated":{"line":1,"column":101}},{"source":"lib/mediasoup-viewer.js","original":{"line":5,"column":15},"generated":{"line":1,"column":103}},{"source":"lib/mediasoup-viewer.js","name":"server","original":{"line":5,"column":26},"generated":{"line":1,"column":110}},{"source":"lib/mediasoup-viewer.js","original":{"line":5,"column":36},"generated":{"line":1,"column":112}},{"source":"lib/mediasoup-viewer.js","original":{"line":5,"column":15},"generated":{"line":1,"column":134}},{"source":"lib/mediasoup-viewer.js","name":"streamKey","original":{"line":5,"column":58},"generated":{"line":1,"column":144}},{"source":"lib/mediasoup-viewer.js","original":{"line":5,"column":70},"generated":{"line":1,"column":146}},{"source":"lib/mediasoup-viewer.js","original":{"line":6,"column":4},"generated":{"line":1,"column":155}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":7,"column":9},"generated":{"line":1,"column":163}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":7,"column":9},"generated":{"line":1,"column":168}},{"source":"lib/mediasoup-viewer.js","original":{"line":7,"column":16},"generated":{"line":1,"column":173}},{"source":"lib/mediasoup-viewer.js","name":"Room","original":{"line":7,"column":20},"generated":{"line":1,"column":177}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":8,"column":9},"generated":{"line":1,"column":179}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":8,"column":9},"generated":{"line":1,"column":184}},{"source":"lib/mediasoup-viewer.js","original":{"line":8,"column":18},"generated":{"line":1,"column":191}},{"source":"lib/mediasoup-viewer.js","name":"audio","original":{"line":8,"column":20},"generated":{"line":1,"column":192}},{"source":"lib/mediasoup-viewer.js","original":{"line":8,"column":27},"generated":{"line":1,"column":198}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":8,"column":33},"generated":{"line":1,"column":203}},{"source":"lib/mediasoup-viewer.js","original":{"line":8,"column":40},"generated":{"line":1,"column":209}},{"source":"lib/mediasoup-viewer.js","name":"isActive","original":{"line":9,"column":9},"generated":{"line":1,"column":215}},{"source":"lib/mediasoup-viewer.js","name":"isActive","original":{"line":9,"column":9},"generated":{"line":1,"column":220}},{"source":"lib/mediasoup-viewer.js","original":{"line":9,"column":20},"generated":{"line":1,"column":230}},{"source":"lib/mediasoup-viewer.js","name":"_server","original":{"line":11,"column":10},"generated":{"line":1,"column":232}},{"source":"lib/mediasoup-viewer.js","name":"_server","original":{"line":11,"column":10},"generated":{"line":1,"column":238}},{"source":"lib/mediasoup-viewer.js","name":"server","original":{"line":11,"column":23},"generated":{"line":1,"column":243}},{"source":"lib/mediasoup-viewer.js","name":"streamKey","original":{"line":11,"column":41},"generated":{"line":1,"column":256}},{"source":"lib/mediasoup-viewer.js","name":"console","original":{"line":12,"column":4},"generated":{"line":1,"column":260}},{"source":"lib/mediasoup-viewer.js","name":"log","original":{"line":12,"column":12},"generated":{"line":1,"column":268}},{"source":"lib/mediasoup-viewer.js","original":{"line":12,"column":16},"generated":{"line":1,"column":272}},{"source":"lib/mediasoup-viewer.js","name":"_server","original":{"line":12,"column":33},"generated":{"line":1,"column":288}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":13,"column":9},"generated":{"line":1,"column":291}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":13,"column":9},"generated":{"line":1,"column":296}},{"source":"lib/mediasoup-viewer.js","name":"join","original":{"line":13,"column":14},"generated":{"line":1,"column":301}},{"source":"lib/mediasoup-viewer.js","name":"_server","original":{"line":13,"column":19},"generated":{"line":1,"column":306}},{"source":"lib/mediasoup-viewer.js","name":"videoEl","original":{"line":15,"column":8},"generated":{"line":1,"column":309}},{"source":"lib/mediasoup-viewer.js","name":"videoEl","original":{"line":16,"column":6},"generated":{"line":1,"column":313}},{"source":"lib/mediasoup-viewer.js","name":"document","original":{"line":16,"column":16},"generated":{"line":1,"column":315}},{"source":"lib/mediasoup-viewer.js","name":"createElement","original":{"line":16,"column":25},"generated":{"line":1,"column":324}},{"source":"lib/mediasoup-viewer.js","original":{"line":16,"column":39},"generated":{"line":1,"column":338}},{"source":"lib/mediasoup-viewer.js","name":"document","original":{"line":17,"column":6},"generated":{"line":1,"column":347}},{"source":"lib/mediasoup-viewer.js","name":"body","original":{"line":17,"column":15},"generated":{"line":1,"column":356}},{"source":"lib/mediasoup-viewer.js","name":"appendChild","original":{"line":17,"column":20},"generated":{"line":1,"column":361}},{"source":"lib/mediasoup-viewer.js","name":"videoEl","original":{"line":17,"column":32},"generated":{"line":1,"column":373}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":19,"column":9},"generated":{"line":1,"column":377}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":19,"column":9},"generated":{"line":1,"column":382}},{"source":"lib/mediasoup-viewer.js","name":"videoEl","original":{"line":19,"column":17},"generated":{"line":1,"column":388}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":23,"column":9},"generated":{"line":1,"column":390}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":23,"column":9},"generated":{"line":1,"column":395}},{"source":"lib/mediasoup-viewer.js","name":"addEventListener","original":{"line":23,"column":15},"generated":{"line":1,"column":401}},{"source":"lib/mediasoup-viewer.js","original":{"line":23,"column":32},"generated":{"line":1,"column":418}},{"source":"lib/mediasoup-viewer.js","name":"event","original":{"line":23,"column":44},"generated":{"line":1,"column":428}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":27,"column":9},"generated":{"line":1,"column":435}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":27,"column":9},"generated":{"line":1,"column":440}},{"source":"lib/mediasoup-viewer.js","name":"on","original":{"line":27,"column":14},"generated":{"line":1,"column":445}},{"source":"lib/mediasoup-viewer.js","original":{"line":27,"column":17},"generated":{"line":1,"column":448}},{"source":"lib/mediasoup-viewer.js","original":{"line":27,"column":30},"generated":{"line":1,"column":460}},{"source":"lib/mediasoup-viewer.js","original":{"line":27,"column":30},"generated":{"line":1,"column":466}},{"source":"lib/mediasoup-viewer.js","original":{"line":28,"column":12},"generated":{"line":1,"column":470}},{"source":"lib/mediasoup-viewer.js","original":{"line":28,"column":12},"generated":{"line":1,"column":476}},{"source":"lib/mediasoup-viewer.js","name":"id","original":{"line":29,"column":8},"generated":{"line":1,"column":479}},{"source":"lib/mediasoup-viewer.js","name":"appData","original":{"line":30,"column":8},"generated":{"line":1,"column":481}},{"source":"lib/mediasoup-viewer.js","original":{"line":30,"column":17},"generated":{"line":1,"column":490}},{"source":"lib/mediasoup-viewer.js","name":"peerId","original":{"line":30,"column":19},"generated":{"line":1,"column":497}},{"source":"lib/mediasoup-viewer.js","original":{"line":28,"column":12},"generated":{"line":1,"column":500}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":31,"column":8},"generated":{"line":1,"column":506}},{"source":"lib/mediasoup-viewer.js","name":"consumer","original":{"line":32,"column":10},"generated":{"line":1,"column":509}},{"source":"lib/mediasoup-viewer.js","name":"addTrack","original":{"line":37,"column":11},"generated":{"line":1,"column":511}},{"source":"lib/mediasoup-viewer.js","name":"addTrack","original":{"line":37,"column":11},"generated":{"line":1,"column":516}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":37,"column":20},"generated":{"line":1,"column":525}},{"source":"lib/mediasoup-viewer.js","name":"peerId","original":{"line":37,"column":27},"generated":{"line":1,"column":527}},{"source":"lib/mediasoup-viewer.js","name":"id","original":{"line":37,"column":35},"generated":{"line":1,"column":529}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":40,"column":9},"generated":{"line":1,"column":534}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":40,"column":9},"generated":{"line":1,"column":539}},{"source":"lib/mediasoup-viewer.js","name":"on","original":{"line":40,"column":14},"generated":{"line":1,"column":544}},{"source":"lib/mediasoup-viewer.js","original":{"line":40,"column":17},"generated":{"line":1,"column":547}},{"source":"lib/mediasoup-viewer.js","name":"consumer","original":{"line":40,"column":37},"generated":{"line":1,"column":565}},{"source":"lib/mediasoup-viewer.js","name":"console","original":{"line":41,"column":6},"generated":{"line":1,"column":569}},{"source":"lib/mediasoup-viewer.js","name":"log","original":{"line":41,"column":14},"generated":{"line":1,"column":577}},{"source":"lib/mediasoup-viewer.js","name":"consumer","original":{"line":41,"column":18},"generated":{"line":1,"column":581}},{"source":"lib/mediasoup-viewer.js","name":"console","original":{"line":42,"column":6},"generated":{"line":1,"column":584}},{"source":"lib/mediasoup-viewer.js","name":"log","original":{"line":42,"column":14},"generated":{"line":1,"column":592}},{"source":"lib/mediasoup-viewer.js","name":"consumer","original":{"line":42,"column":18},"generated":{"line":1,"column":596}},{"source":"lib/mediasoup-viewer.js","name":"consumerId","original":{"line":42,"column":27},"generated":{"line":1,"column":598}},{"source":"lib/mediasoup-viewer.js","name":"removeTrack","original":{"line":43,"column":11},"generated":{"line":1,"column":610}},{"source":"lib/mediasoup-viewer.js","name":"removeTrack","original":{"line":43,"column":11},"generated":{"line":1,"column":615}},{"source":"lib/mediasoup-viewer.js","name":"consumer","original":{"line":43,"column":23},"generated":{"line":1,"column":627}},{"source":"lib/mediasoup-viewer.js","name":"consumerId","original":{"line":43,"column":32},"generated":{"line":1,"column":629}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":47,"column":9},"generated":{"line":1,"column":643}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":47,"column":9},"generated":{"line":1,"column":648}},{"source":"lib/mediasoup-viewer.js","name":"on","original":{"line":47,"column":14},"generated":{"line":1,"column":653}},{"source":"lib/mediasoup-viewer.js","original":{"line":47,"column":17},"generated":{"line":1,"column":656}},{"source":"lib/mediasoup-viewer.js","original":{"line":47,"column":36},"generated":{"line":1,"column":674}},{"source":"lib/mediasoup-viewer.js","name":"producerId","original":{"line":47,"column":39},"generated":{"line":1,"column":676}},{"source":"lib/mediasoup-viewer.js","name":"producerId","original":{"line":47,"column":39},"generated":{"line":1,"column":687}},{"source":"lib/mediasoup-viewer.js","name":"console","original":{"line":48,"column":6},"generated":{"line":1,"column":693}},{"source":"lib/mediasoup-viewer.js","name":"log","original":{"line":48,"column":14},"generated":{"line":1,"column":701}},{"source":"lib/mediasoup-viewer.js","original":{"line":48,"column":18},"generated":{"line":1,"column":705}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":52,"column":9},"generated":{"line":1,"column":726}},{"source":"lib/mediasoup-viewer.js","name":"room","original":{"line":52,"column":9},"generated":{"line":1,"column":731}},{"source":"lib/mediasoup-viewer.js","name":"on","original":{"line":52,"column":14},"generated":{"line":1,"column":736}},{"source":"lib/mediasoup-viewer.js","original":{"line":52,"column":17},"generated":{"line":1,"column":739}},{"source":"lib/mediasoup-viewer.js","original":{"line":52,"column":32},"generated":{"line":1,"column":753}},{"source":"lib/mediasoup-viewer.js","name":"peerId","original":{"line":52,"column":35},"generated":{"line":1,"column":755}},{"source":"lib/mediasoup-viewer.js","name":"peerId","original":{"line":52,"column":35},"generated":{"line":1,"column":762}},{"source":"lib/mediasoup-viewer.js","name":"addTrack","original":{"line":57,"column":2},"generated":{"line":1,"column":771}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":57,"column":11},"generated":{"line":1,"column":780}},{"source":"lib/mediasoup-viewer.js","name":"peerId","original":{"line":57,"column":18},"generated":{"line":1,"column":782}},{"source":"lib/mediasoup-viewer.js","name":"consumerId","original":{"line":57,"column":26},"generated":{"line":1,"column":784}},{"source":"lib/mediasoup-viewer.js","original":{"line":58,"column":7},"generated":{"line":1,"column":787}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":58,"column":12},"generated":{"line":1,"column":792}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":58,"column":19},"generated":{"line":1,"column":799}},{"source":"lib/mediasoup-viewer.js","name":"kind","original":{"line":58,"column":25},"generated":{"line":1,"column":801}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":61,"column":9},"generated":{"line":1,"column":807}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":61,"column":9},"generated":{"line":1,"column":812}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":61,"column":16},"generated":{"line":1,"column":819}},{"source":"lib/mediasoup-viewer.js","name":"kind","original":{"line":61,"column":22},"generated":{"line":1,"column":821}},{"source":"lib/mediasoup-viewer.js","original":{"line":61,"column":30},"generated":{"line":1,"column":827}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":62,"column":6},"generated":{"line":1,"column":828}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":62,"column":13},"generated":{"line":1,"column":834}},{"source":"lib/mediasoup-viewer.js","name":"peerId","original":{"line":63,"column":6},"generated":{"line":1,"column":836}},{"source":"lib/mediasoup-viewer.js","name":"peerId","original":{"line":63,"column":14},"generated":{"line":1,"column":843}},{"source":"lib/mediasoup-viewer.js","name":"consumerId","original":{"line":64,"column":6},"generated":{"line":1,"column":845}},{"source":"lib/mediasoup-viewer.js","name":"consumerId","original":{"line":64,"column":18},"generated":{"line":1,"column":856}},{"source":"lib/mediasoup-viewer.js","name":"updateStream","original":{"line":66,"column":9},"generated":{"line":1,"column":859}},{"source":"lib/mediasoup-viewer.js","name":"updateStream","original":{"line":66,"column":9},"generated":{"line":1,"column":864}},{"source":"lib/mediasoup-viewer.js","name":"updateStream","original":{"line":69,"column":3},"generated":{"line":1,"column":879}},{"source":"lib/mediasoup-viewer.js","name":"stream","original":{"line":71,"column":10},"generated":{"line":1,"column":894}},{"source":"lib/mediasoup-viewer.js","name":"stream","original":{"line":71,"column":10},"generated":{"line":1,"column":900}},{"source":"lib/mediasoup-viewer.js","original":{"line":71,"column":19},"generated":{"line":1,"column":902}},{"source":"lib/mediasoup-viewer.js","name":"MediaStream","original":{"line":71,"column":23},"generated":{"line":1,"column":906}},{"source":"lib/mediasoup-viewer.js","original":{"line":72,"column":29},"generated":{"line":1,"column":918}},{"source":"lib/mediasoup-viewer.js","original":{"line":72,"column":7},"generated":{"line":1,"column":925}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":72,"column":12},"generated":{"line":1,"column":930}},{"source":"lib/mediasoup-viewer.js","name":"audio","original":{"line":72,"column":19},"generated":{"line":1,"column":937}},{"source":"lib/mediasoup-viewer.js","name":"stream","original":{"line":72,"column":35},"generated":{"line":1,"column":944}},{"source":"lib/mediasoup-viewer.js","name":"addTrack","original":{"line":72,"column":42},"generated":{"line":1,"column":946}},{"source":"lib/mediasoup-viewer.js","original":{"line":72,"column":51},"generated":{"line":1,"column":955}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":72,"column":56},"generated":{"line":1,"column":960}},{"source":"lib/mediasoup-viewer.js","name":"audio","original":{"line":72,"column":63},"generated":{"line":1,"column":967}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":72,"column":69},"generated":{"line":1,"column":973}},{"source":"lib/mediasoup-viewer.js","original":{"line":73,"column":29},"generated":{"line":1,"column":980}},{"source":"lib/mediasoup-viewer.js","original":{"line":73,"column":7},"generated":{"line":1,"column":987}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":73,"column":12},"generated":{"line":1,"column":992}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":73,"column":19},"generated":{"line":1,"column":999}},{"source":"lib/mediasoup-viewer.js","name":"stream","original":{"line":73,"column":35},"generated":{"line":1,"column":1006}},{"source":"lib/mediasoup-viewer.js","name":"addTrack","original":{"line":73,"column":42},"generated":{"line":1,"column":1008}},{"source":"lib/mediasoup-viewer.js","original":{"line":73,"column":51},"generated":{"line":1,"column":1017}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":73,"column":56},"generated":{"line":1,"column":1022}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":73,"column":63},"generated":{"line":1,"column":1029}},{"source":"lib/mediasoup-viewer.js","name":"track","original":{"line":73,"column":69},"generated":{"line":1,"column":1035}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":74,"column":9},"generated":{"line":1,"column":1042}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":74,"column":9},"generated":{"line":1,"column":1047}},{"source":"lib/mediasoup-viewer.js","name":"srcObject","original":{"line":74,"column":15},"generated":{"line":1,"column":1053}},{"source":"lib/mediasoup-viewer.js","name":"stream","original":{"line":74,"column":27},"generated":{"line":1,"column":1063}},{"source":"lib/mediasoup-viewer.js","name":"isActive","original":{"line":76,"column":9},"generated":{"line":1,"column":1065}},{"source":"lib/mediasoup-viewer.js","name":"isActive","original":{"line":76,"column":9},"generated":{"line":1,"column":1070}},{"source":"lib/mediasoup-viewer.js","original":{"line":76,"column":20},"generated":{"line":1,"column":1080}},{"source":"lib/mediasoup-viewer.js","original":{"line":77,"column":29},"generated":{"line":1,"column":1082}},{"source":"lib/mediasoup-viewer.js","original":{"line":77,"column":7},"generated":{"line":1,"column":1089}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":77,"column":12},"generated":{"line":1,"column":1094}},{"source":"lib/mediasoup-viewer.js","name":"audio","original":{"line":77,"column":19},"generated":{"line":1,"column":1101}},{"source":"lib/mediasoup-viewer.js","original":{"line":77,"column":59},"generated":{"line":1,"column":1108}},{"source":"lib/mediasoup-viewer.js","original":{"line":77,"column":37},"generated":{"line":1,"column":1115}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":77,"column":42},"generated":{"line":1,"column":1120}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":77,"column":49},"generated":{"line":1,"column":1127}},{"source":"lib/mediasoup-viewer.js","original":{"line":77,"column":65},"generated":{"line":1,"column":1135}},{"source":"lib/mediasoup-viewer.js","name":"isActive","original":{"line":77,"column":70},"generated":{"line":1,"column":1140}},{"source":"lib/mediasoup-viewer.js","original":{"line":77,"column":81},"generated":{"line":1,"column":1150}},{"source":"lib/mediasoup-viewer.js","name":"emit","original":{"line":80,"column":9},"generated":{"line":1,"column":1153}},{"source":"lib/mediasoup-viewer.js","name":"emit","original":{"line":80,"column":9},"generated":{"line":1,"column":1158}},{"source":"lib/mediasoup-viewer.js","original":{"line":80,"column":14},"generated":{"line":1,"column":1163}},{"source":"lib/mediasoup-viewer.js","original":{"line":80,"column":24},"generated":{"line":1,"column":1172}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":80,"column":29},"generated":{"line":1,"column":1177}},{"source":"lib/mediasoup-viewer.js","name":"removeTrack","original":{"line":83,"column":2},"generated":{"line":1,"column":1185}},{"source":"lib/mediasoup-viewer.js","name":"id","original":{"line":83,"column":14},"generated":{"line":1,"column":1197}},{"source":"lib/mediasoup-viewer.js","original":{"line":85,"column":29},"generated":{"line":1,"column":1200}},{"source":"lib/mediasoup-viewer.js","original":{"line":85,"column":7},"generated":{"line":1,"column":1207}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":85,"column":12},"generated":{"line":1,"column":1212}},{"source":"lib/mediasoup-viewer.js","name":"audio","original":{"line":85,"column":19},"generated":{"line":1,"column":1219}},{"source":"lib/mediasoup-viewer.js","original":{"line":85,"column":37},"generated":{"line":1,"column":1226}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":85,"column":42},"generated":{"line":1,"column":1231}},{"source":"lib/mediasoup-viewer.js","name":"audio","original":{"line":85,"column":49},"generated":{"line":1,"column":1238}},{"source":"lib/mediasoup-viewer.js","name":"consumerId","original":{"line":85,"column":55},"generated":{"line":1,"column":1244}},{"source":"lib/mediasoup-viewer.js","name":"id","original":{"line":85,"column":70},"generated":{"line":1,"column":1257}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":86,"column":11},"generated":{"line":1,"column":1261}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":86,"column":11},"generated":{"line":1,"column":1266}},{"source":"lib/mediasoup-viewer.js","name":"audio","original":{"line":86,"column":18},"generated":{"line":1,"column":1273}},{"source":"lib/mediasoup-viewer.js","original":{"line":86,"column":26},"generated":{"line":1,"column":1279}},{"source":"lib/mediasoup-viewer.js","original":{"line":88,"column":29},"generated":{"line":1,"column":1285}},{"source":"lib/mediasoup-viewer.js","original":{"line":88,"column":7},"generated":{"line":1,"column":1292}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":88,"column":12},"generated":{"line":1,"column":1297}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":88,"column":19},"generated":{"line":1,"column":1304}},{"source":"lib/mediasoup-viewer.js","original":{"line":88,"column":37},"generated":{"line":1,"column":1311}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":88,"column":42},"generated":{"line":1,"column":1316}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":88,"column":49},"generated":{"line":1,"column":1323}},{"source":"lib/mediasoup-viewer.js","name":"consumerId","original":{"line":88,"column":55},"generated":{"line":1,"column":1329}},{"source":"lib/mediasoup-viewer.js","name":"id","original":{"line":88,"column":70},"generated":{"line":1,"column":1342}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":89,"column":11},"generated":{"line":1,"column":1346}},{"source":"lib/mediasoup-viewer.js","name":"tracks","original":{"line":89,"column":11},"generated":{"line":1,"column":1351}},{"source":"lib/mediasoup-viewer.js","name":"video","original":{"line":89,"column":18},"generated":{"line":1,"column":1358}},{"source":"lib/mediasoup-viewer.js","original":{"line":89,"column":26},"generated":{"line":1,"column":1364}},{"source":"lib/mediasoup-viewer.js","name":"updateStream","original":{"line":91,"column":9},"generated":{"line":1,"column":1370}},{"source":"lib/mediasoup-viewer.js","name":"updateStream","original":{"line":91,"column":9},"generated":{"line":1,"column":1375}}],"sources":{"lib/mediasoup-viewer.js":"const Room = require('./room.js')\nconst EventEmitter = require('events')\n\nmodule.exports = class Viewer extends EventEmitter{\n  constructor ({ videoEl, server = `ws://localhost:2345`, streamKey = \"test\"}) {\n    super()\n    this.room = new Room()\n    this.tracks = { audio: null, video: null }\n    this.isActive = false\n\n    const _server = `${server}/?stream=${streamKey}`\n    console.log('connecting to', _server)\n    this.room.join(_server)\n\n    if(!videoEl) {\n      videoEl = document.createElement('video')\n      document.body.appendChild(videoEl)\n    }\n    this.video = videoEl\n  //  this.video.autoplay = true\n  //  this.video.muted = true\n\n    this.video.addEventListener('canplay', (event) => {\n  //console.log('Video can start, but not sure it will play through.');\n});\n\n    this.room.on(\"@consumer\", async consumer => {\n      const {\n        id,\n        appData: { peerId },\n        track\n      } = consumer;\n    //  console.log(\"receive consumer\", consumer);\n      //\n      // const el = createMediaEl(track, peerId, id);\n      // document.body.append(el)\n      this.addTrack(track, peerId, id)\n    });\n\n    this.room.on(\"@consumerClosed\", (consumer) => {\n      console.log(consumer)\n      console.log(consumer.consumerId)\n      this.removeTrack(consumer.consumerId)\n      //removeMediaEl(document.body, \"data-search-id\", consumerId);\n    });\n\n    this.room.on(\"@producerClosed\", ({ producerId }) => {\n      console.log('producer closed')\n    //  removeMediaEl(localTracks, \"data-search-id\", producerId);\n    });\n\n    this.room.on(\"@peerClosed\", ({ peerId }) => {\n    //  removeMediaEl(remoteTracks, \"data-peer-id\", peerId);\n    });\n  }\n\n  addTrack(track, peerId, consumerId) {\n    if(this.tracks[track.kind] !== null) {\n      // remove track\n    }\n    this.tracks[track.kind] = {\n      track: track,\n      peerId: peerId,\n      consumerId: consumerId\n    }\n    this.updateStream()\n  }\n\n   updateStream() {\n  //  console.log('updating stream', tracks)\n    const stream = new MediaStream()\n    if(this.tracks.audio !== null) stream.addTrack(this.tracks.audio.track)\n    if(this.tracks.video !== null) stream.addTrack(this.tracks.video.track)\n    this.video.srcObject = stream\n\n    this.isActive = true\n    if(this.tracks.audio === null && this.tracks.video === null) this.isActive = false\n  //  console.log('active', isActive)\n  //  onUpdate(tracks)\n    this.emit('update', this.tracks)\n  }\n\n  removeTrack(id) {\n  //  console.log('removing tracks', id, tracks)\n    if(this.tracks.audio !== null && this.tracks.audio.consumerId === id) {\n      this.tracks.audio = null\n    }\n    if(this.tracks.video !== null && this.tracks.video.consumerId === id) {\n      this.tracks.video = null\n    }\n    this.updateStream()\n  }\n}\n\n// ({ videoEl, server = `ws://localhost:2345`, streamKey = \"test\", onUpdate = () => {}}) => {\n//\n//\n//   function createMediaEl(track, peerId, searchId) {\n//     const el = document.createElement(track.kind);\n//     el.srcObject = new MediaStream([track]);\n//     el.autoplay = true\n//     el.setAttribute(\"data-peer-id\", peerId);\n//     el.setAttribute(\"data-search-id\", searchId);\n//     el.playsInline = true;\n//   //  el.play().catch(console.error);\n//     return el;\n//   }\n//\n//   return {\n//     this.room: this.room,\n//     tracks: tracks,\n//     server: server,\n//     isActive: isActive\n//   }\n// }\n"},"lineCount":null}},"error":null,"hash":"0784fb3375a18ec5db46a0acebaa234e","cacheData":{"env":{}}}