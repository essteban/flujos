{"id":"ziqe","dependencies":[{"name":"/Users/ojack/PROJECTS/flujos/package.json","includedInParent":true,"mtime":1618339867251},{"name":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/package.json","includedInParent":true,"mtime":1618112785836},{"name":"websocket","loc":{"line":1,"column":29},"parent":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/lib/transports/WebSocketTransport.js","resolved":"/Users/ojack/PROJECTS/flujos/node_modules/websocket/lib/browser.js"},{"name":"retry","loc":{"line":2,"column":22},"parent":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/lib/transports/WebSocketTransport.js","resolved":"/Users/ojack/PROJECTS/flujos/node_modules/retry/index.js"},{"name":"../Logger","loc":{"line":3,"column":23},"parent":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/lib/transports/WebSocketTransport.js","resolved":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/lib/Logger.js"},{"name":"../EnhancedEventEmitter","loc":{"line":4,"column":37},"parent":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/lib/transports/WebSocketTransport.js","resolved":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/lib/EnhancedEventEmitter.js"},{"name":"../Message","loc":{"line":5,"column":24},"parent":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/lib/transports/WebSocketTransport.js","resolved":"/Users/ojack/PROJECTS/flujos/node_modules/protoo-client/lib/Message.js"}],"generated":{"js":"const e=require(\"websocket\").w3cwebsocket,s=require(\"retry\"),t=require(\"../Logger\"),o=require(\"../EnhancedEventEmitter\"),r=require(\"../Message\"),i=\"protoo\",n={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},c=new t(\"WebSocketTransport\");class h extends o{constructor(e,s){super(c),c.debug(\"constructor() [url:%s, options:%o]\",e,s),this._closed=!1,this._url=e,this._options=s||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){c.debug(\"close()\"),this._closed=!0,this.safeEmit(\"close\");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){c.error(\"close() | error closing the WebSocket: %o\",e)}}}async send(e){if(this._closed)throw new Error(\"transport closed\");try{this._ws.send(JSON.stringify(e))}catch(s){throw c.warn(\"send() failed:%o\",s),s}}_runWebSocket(){const t=s.operation(this._options.retry||n);let o=!1;t.attempt(s=>{this._closed?t.stop():(c.debug(\"_runWebSocket() [currentAttempt:%s]\",s),this._ws=new e(this._url,i,this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=(()=>{this._closed||(o=!0,this.safeEmit(\"open\"))}),this._ws.onclose=(e=>{if(!this._closed){if(c.warn('WebSocket \"close\" event [wasClean:%s, code:%s, reason:\"%s\"]',e.wasClean,e.code,e.reason),4e3!==e.code){if(o){if(t.stop(),this.safeEmit(\"disconnected\"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit(\"failed\",s),this._closed)return;if(t.retry(!0))return}this._closed=!0,this.safeEmit(\"close\")}}),this._ws.onerror=(()=>{this._closed||c.error('WebSocket \"error\" event')}),this._ws.onmessage=(e=>{if(this._closed)return;const s=r.parse(e.data);s&&(0!==this.listenerCount(\"message\")?this.safeEmit(\"message\",s):c.error('no listeners for WebSocket \"message\" event, ignoring received message'))}))})}}module.exports=h;"},"sourceMaps":{"js":{"mappings":[{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"W3CWebSocket","original":{"line":1,"column":6},"generated":{"line":1,"column":6}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"require","original":{"line":1,"column":21},"generated":{"line":1,"column":8}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":1,"column":29},"generated":{"line":1,"column":16}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"w3cwebsocket","original":{"line":1,"column":42},"generated":{"line":1,"column":29}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"retry","original":{"line":2,"column":6},"generated":{"line":1,"column":42}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"require","original":{"line":2,"column":14},"generated":{"line":1,"column":44}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":2,"column":22},"generated":{"line":1,"column":52}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"Logger","original":{"line":3,"column":6},"generated":{"line":1,"column":61}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"require","original":{"line":3,"column":15},"generated":{"line":1,"column":63}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":3,"column":23},"generated":{"line":1,"column":71}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"EnhancedEventEmitter","original":{"line":4,"column":6},"generated":{"line":1,"column":84}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"require","original":{"line":4,"column":29},"generated":{"line":1,"column":86}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":4,"column":37},"generated":{"line":1,"column":94}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"Message","original":{"line":5,"column":6},"generated":{"line":1,"column":121}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"require","original":{"line":5,"column":16},"generated":{"line":1,"column":123}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":5,"column":24},"generated":{"line":1,"column":131}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"WS_SUBPROTOCOL","original":{"line":7,"column":6},"generated":{"line":1,"column":145}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":7,"column":23},"generated":{"line":1,"column":147}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"DEFAULT_RETRY_OPTIONS","original":{"line":8,"column":6},"generated":{"line":1,"column":156}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":9,"column":0},"generated":{"line":1,"column":158}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"retries","original":{"line":10,"column":1},"generated":{"line":1,"column":159}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":10,"column":14},"generated":{"line":1,"column":167}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"factor","original":{"line":11,"column":1},"generated":{"line":1,"column":170}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":11,"column":14},"generated":{"line":1,"column":177}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"minTimeout","original":{"line":12,"column":1},"generated":{"line":1,"column":179}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":12,"column":14},"generated":{"line":1,"column":190}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"maxTimeout","original":{"line":13,"column":1},"generated":{"line":1,"column":194}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":13,"column":14},"generated":{"line":1,"column":205}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":16,"column":6},"generated":{"line":1,"column":210}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":16,"column":15},"generated":{"line":1,"column":212}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"Logger","original":{"line":16,"column":19},"generated":{"line":1,"column":216}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":16,"column":26},"generated":{"line":1,"column":218}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":18,"column":0},"generated":{"line":1,"column":240}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"WebSocketTransport","original":{"line":18,"column":6},"generated":{"line":1,"column":246}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"EnhancedEventEmitter","original":{"line":18,"column":33},"generated":{"line":1,"column":256}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"constructor","original":{"line":24,"column":1},"generated":{"line":1,"column":258}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"url","original":{"line":24,"column":13},"generated":{"line":1,"column":270}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"options","original":{"line":24,"column":18},"generated":{"line":1,"column":272}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":26,"column":8},"generated":{"line":1,"column":275}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":26,"column":8},"generated":{"line":1,"column":281}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":28,"column":2},"generated":{"line":1,"column":284}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"debug","original":{"line":28,"column":9},"generated":{"line":1,"column":286}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":28,"column":15},"generated":{"line":1,"column":292}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"url","original":{"line":28,"column":53},"generated":{"line":1,"column":329}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"options","original":{"line":28,"column":58},"generated":{"line":1,"column":331}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":32,"column":7},"generated":{"line":1,"column":334}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":32,"column":7},"generated":{"line":1,"column":339}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":32,"column":17},"generated":{"line":1,"column":348}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_url","original":{"line":36,"column":7},"generated":{"line":1,"column":350}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_url","original":{"line":36,"column":7},"generated":{"line":1,"column":355}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"url","original":{"line":36,"column":14},"generated":{"line":1,"column":360}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_options","original":{"line":40,"column":7},"generated":{"line":1,"column":362}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_options","original":{"line":40,"column":7},"generated":{"line":1,"column":367}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"options","original":{"line":40,"column":18},"generated":{"line":1,"column":376}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":40,"column":29},"generated":{"line":1,"column":379}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":44,"column":7},"generated":{"line":1,"column":382}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":44,"column":7},"generated":{"line":1,"column":387}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":44,"column":13},"generated":{"line":1,"column":391}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_runWebSocket","original":{"line":47,"column":7},"generated":{"line":1,"column":396}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_runWebSocket","original":{"line":47,"column":7},"generated":{"line":1,"column":401}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"closed","original":{"line":50,"column":5},"generated":{"line":1,"column":417}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":52,"column":9},"generated":{"line":1,"column":430}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":52,"column":9},"generated":{"line":1,"column":437}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":52,"column":14},"generated":{"line":1,"column":442}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"close","original":{"line":55,"column":1},"generated":{"line":1,"column":450}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":57,"column":6},"generated":{"line":1,"column":458}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":57,"column":6},"generated":{"line":1,"column":462}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":57,"column":11},"generated":{"line":1,"column":467}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":57,"column":6},"generated":{"line":1,"column":475}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":60,"column":2},"generated":{"line":1,"column":476}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"debug","original":{"line":60,"column":9},"generated":{"line":1,"column":478}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":60,"column":15},"generated":{"line":1,"column":484}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":63,"column":7},"generated":{"line":1,"column":495}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":63,"column":7},"generated":{"line":1,"column":500}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":63,"column":17},"generated":{"line":1,"column":509}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":64,"column":7},"generated":{"line":1,"column":511}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":64,"column":7},"generated":{"line":1,"column":516}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":64,"column":16},"generated":{"line":1,"column":525}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":67,"column":2},"generated":{"line":1,"column":534}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":68,"column":8},"generated":{"line":1,"column":538}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":68,"column":8},"generated":{"line":1,"column":543}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"onopen","original":{"line":68,"column":12},"generated":{"line":1,"column":547}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":68,"column":21},"generated":{"line":1,"column":554}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":69,"column":8},"generated":{"line":1,"column":559}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":69,"column":8},"generated":{"line":1,"column":564}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"onclose","original":{"line":69,"column":12},"generated":{"line":1,"column":568}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":69,"column":22},"generated":{"line":1,"column":576}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":70,"column":8},"generated":{"line":1,"column":581}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":70,"column":8},"generated":{"line":1,"column":586}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"onerror","original":{"line":70,"column":12},"generated":{"line":1,"column":590}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":70,"column":22},"generated":{"line":1,"column":598}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":71,"column":8},"generated":{"line":1,"column":603}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":71,"column":8},"generated":{"line":1,"column":608}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"onmessage","original":{"line":71,"column":12},"generated":{"line":1,"column":612}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":71,"column":24},"generated":{"line":1,"column":622}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":72,"column":8},"generated":{"line":1,"column":627}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":72,"column":8},"generated":{"line":1,"column":632}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"close","original":{"line":72,"column":12},"generated":{"line":1,"column":636}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":74,"column":2},"generated":{"line":1,"column":644}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":74,"column":9},"generated":{"line":1,"column":650}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":76,"column":3},"generated":{"line":1,"column":653}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":76,"column":10},"generated":{"line":1,"column":655}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":76,"column":16},"generated":{"line":1,"column":661}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":76,"column":61},"generated":{"line":1,"column":705}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"send","original":{"line":80,"column":7},"generated":{"line":1,"column":710}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"message","original":{"line":80,"column":12},"generated":{"line":1,"column":721}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":82,"column":6},"generated":{"line":1,"column":724}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":82,"column":6},"generated":{"line":1,"column":727}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":82,"column":11},"generated":{"line":1,"column":732}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":83,"column":3},"generated":{"line":1,"column":740}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":83,"column":9},"generated":{"line":1,"column":746}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"Error","original":{"line":83,"column":13},"generated":{"line":1,"column":750}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":83,"column":19},"generated":{"line":1,"column":756}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":86,"column":2},"generated":{"line":1,"column":776}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":87,"column":8},"generated":{"line":1,"column":780}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":87,"column":8},"generated":{"line":1,"column":785}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"send","original":{"line":87,"column":12},"generated":{"line":1,"column":789}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"JSON","original":{"line":87,"column":17},"generated":{"line":1,"column":794}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"stringify","original":{"line":87,"column":22},"generated":{"line":1,"column":799}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"message","original":{"line":87,"column":32},"generated":{"line":1,"column":809}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":89,"column":2},"generated":{"line":1,"column":813}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":89,"column":9},"generated":{"line":1,"column":819}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":93,"column":9},"generated":{"line":1,"column":822}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":91,"column":3},"generated":{"line":1,"column":828}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"warn","original":{"line":91,"column":10},"generated":{"line":1,"column":830}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":91,"column":15},"generated":{"line":1,"column":835}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":91,"column":35},"generated":{"line":1,"column":854}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":93,"column":9},"generated":{"line":1,"column":857}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_runWebSocket","original":{"line":97,"column":1},"generated":{"line":1,"column":860}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"operation","original":{"line":99,"column":8},"generated":{"line":1,"column":876}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"operation","original":{"line":99,"column":8},"generated":{"line":1,"column":882}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"retry","original":{"line":100,"column":3},"generated":{"line":1,"column":884}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"operation","original":{"line":100,"column":9},"generated":{"line":1,"column":886}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":100,"column":19},"generated":{"line":1,"column":896}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_options","original":{"line":100,"column":24},"generated":{"line":1,"column":901}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"retry","original":{"line":100,"column":33},"generated":{"line":1,"column":910}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"DEFAULT_RETRY_OPTIONS","original":{"line":100,"column":42},"generated":{"line":1,"column":917}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"wasConnected","original":{"line":102,"column":6},"generated":{"line":1,"column":920}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"wasConnected","original":{"line":102,"column":6},"generated":{"line":1,"column":924}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":102,"column":21},"generated":{"line":1,"column":927}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"operation","original":{"line":104,"column":2},"generated":{"line":1,"column":929}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"attempt","original":{"line":104,"column":12},"generated":{"line":1,"column":931}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"currentAttempt","original":{"line":104,"column":21},"generated":{"line":1,"column":939}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":106,"column":7},"generated":{"line":1,"column":943}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":106,"column":12},"generated":{"line":1,"column":948}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"operation","original":{"line":108,"column":4},"generated":{"line":1,"column":956}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"stop","original":{"line":108,"column":14},"generated":{"line":1,"column":958}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":113,"column":3},"generated":{"line":1,"column":966}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"debug","original":{"line":113,"column":10},"generated":{"line":1,"column":968}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":113,"column":16},"generated":{"line":1,"column":974}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"currentAttempt","original":{"line":113,"column":55},"generated":{"line":1,"column":1012}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":115,"column":8},"generated":{"line":1,"column":1015}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":115,"column":8},"generated":{"line":1,"column":1020}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":115,"column":14},"generated":{"line":1,"column":1024}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"W3CWebSocket","original":{"line":115,"column":18},"generated":{"line":1,"column":1028}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":116,"column":4},"generated":{"line":1,"column":1030}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_url","original":{"line":116,"column":9},"generated":{"line":1,"column":1035}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"WS_SUBPROTOCOL","original":{"line":117,"column":4},"generated":{"line":1,"column":1040}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":118,"column":4},"generated":{"line":1,"column":1042}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_options","original":{"line":118,"column":9},"generated":{"line":1,"column":1047}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"origin","original":{"line":118,"column":18},"generated":{"line":1,"column":1056}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":119,"column":4},"generated":{"line":1,"column":1063}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_options","original":{"line":119,"column":9},"generated":{"line":1,"column":1068}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"headers","original":{"line":119,"column":18},"generated":{"line":1,"column":1077}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":120,"column":4},"generated":{"line":1,"column":1085}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_options","original":{"line":120,"column":9},"generated":{"line":1,"column":1090}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"requestOptions","original":{"line":120,"column":18},"generated":{"line":1,"column":1099}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":121,"column":4},"generated":{"line":1,"column":1114}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_options","original":{"line":121,"column":9},"generated":{"line":1,"column":1119}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"clientConfig","original":{"line":121,"column":18},"generated":{"line":1,"column":1128}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":123,"column":8},"generated":{"line":1,"column":1142}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":123,"column":8},"generated":{"line":1,"column":1147}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"onopen","original":{"line":123,"column":12},"generated":{"line":1,"column":1151}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":123,"column":21},"generated":{"line":1,"column":1158}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":125,"column":8},"generated":{"line":1,"column":1164}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":125,"column":13},"generated":{"line":1,"column":1169}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"wasConnected","original":{"line":128,"column":4},"generated":{"line":1,"column":1179}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":128,"column":19},"generated":{"line":1,"column":1182}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":131,"column":9},"generated":{"line":1,"column":1184}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":131,"column":9},"generated":{"line":1,"column":1189}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":131,"column":18},"generated":{"line":1,"column":1198}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":134,"column":8},"generated":{"line":1,"column":1209}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":134,"column":8},"generated":{"line":1,"column":1214}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"onclose","original":{"line":134,"column":12},"generated":{"line":1,"column":1218}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":134,"column":23},"generated":{"line":1,"column":1226}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":134,"column":23},"generated":{"line":1,"column":1227}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":136,"column":8},"generated":{"line":1,"column":1231}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":136,"column":8},"generated":{"line":1,"column":1235}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":136,"column":13},"generated":{"line":1,"column":1240}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":136,"column":8},"generated":{"line":1,"column":1248}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":144,"column":8},"generated":{"line":1,"column":1249}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":139,"column":4},"generated":{"line":1,"column":1252}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"warn","original":{"line":139,"column":11},"generated":{"line":1,"column":1254}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":140,"column":5},"generated":{"line":1,"column":1259}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":141,"column":5},"generated":{"line":1,"column":1321}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"wasClean","original":{"line":141,"column":11},"generated":{"line":1,"column":1323}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":141,"column":21},"generated":{"line":1,"column":1332}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"code","original":{"line":141,"column":27},"generated":{"line":1,"column":1334}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":141,"column":33},"generated":{"line":1,"column":1339}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"reason","original":{"line":141,"column":39},"generated":{"line":1,"column":1341}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":144,"column":23},"generated":{"line":1,"column":1349}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":144,"column":8},"generated":{"line":1,"column":1355}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"code","original":{"line":144,"column":14},"generated":{"line":1,"column":1357}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":145,"column":4},"generated":{"line":1,"column":1362}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":147,"column":9},"generated":{"line":1,"column":1363}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"wasConnected","original":{"line":147,"column":10},"generated":{"line":1,"column":1366}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":159,"column":5},"generated":{"line":1,"column":1368}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":164,"column":10},"generated":{"line":1,"column":1369}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"operation","original":{"line":160,"column":6},"generated":{"line":1,"column":1372}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"stop","original":{"line":160,"column":16},"generated":{"line":1,"column":1374}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":162,"column":11},"generated":{"line":1,"column":1381}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":162,"column":11},"generated":{"line":1,"column":1386}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":162,"column":20},"generated":{"line":1,"column":1395}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":164,"column":10},"generated":{"line":1,"column":1411}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":164,"column":15},"generated":{"line":1,"column":1416}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":165,"column":7},"generated":{"line":1,"column":1424}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":169,"column":6},"generated":{"line":1,"column":1431}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_runWebSocket","original":{"line":167,"column":11},"generated":{"line":1,"column":1443}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_runWebSocket","original":{"line":167,"column":11},"generated":{"line":1,"column":1448}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":151,"column":10},"generated":{"line":1,"column":1464}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":149,"column":11},"generated":{"line":1,"column":1467}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":149,"column":11},"generated":{"line":1,"column":1472}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":149,"column":20},"generated":{"line":1,"column":1481}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"currentAttempt","original":{"line":149,"column":30},"generated":{"line":1,"column":1490}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":151,"column":10},"generated":{"line":1,"column":1493}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":151,"column":15},"generated":{"line":1,"column":1498}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":152,"column":7},"generated":{"line":1,"column":1506}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"operation","original":{"line":154,"column":10},"generated":{"line":1,"column":1513}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"operation","original":{"line":154,"column":10},"generated":{"line":1,"column":1516}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"retry","original":{"line":154,"column":20},"generated":{"line":1,"column":1518}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":154,"column":26},"generated":{"line":1,"column":1525}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":155,"column":7},"generated":{"line":1,"column":1528}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":173,"column":9},"generated":{"line":1,"column":1535}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":173,"column":9},"generated":{"line":1,"column":1540}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":173,"column":19},"generated":{"line":1,"column":1549}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":176,"column":9},"generated":{"line":1,"column":1551}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":176,"column":9},"generated":{"line":1,"column":1556}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":176,"column":18},"generated":{"line":1,"column":1565}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":179,"column":8},"generated":{"line":1,"column":1577}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":179,"column":8},"generated":{"line":1,"column":1582}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"onerror","original":{"line":179,"column":12},"generated":{"line":1,"column":1586}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":179,"column":22},"generated":{"line":1,"column":1594}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":181,"column":8},"generated":{"line":1,"column":1600}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":181,"column":13},"generated":{"line":1,"column":1605}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":184,"column":4},"generated":{"line":1,"column":1614}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":184,"column":11},"generated":{"line":1,"column":1616}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":184,"column":17},"generated":{"line":1,"column":1622}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":187,"column":8},"generated":{"line":1,"column":1651}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_ws","original":{"line":187,"column":8},"generated":{"line":1,"column":1656}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"onmessage","original":{"line":187,"column":12},"generated":{"line":1,"column":1660}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":187,"column":25},"generated":{"line":1,"column":1670}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":187,"column":25},"generated":{"line":1,"column":1671}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":189,"column":8},"generated":{"line":1,"column":1675}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":189,"column":8},"generated":{"line":1,"column":1678}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"_closed","original":{"line":189,"column":13},"generated":{"line":1,"column":1683}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":190,"column":5},"generated":{"line":1,"column":1691}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"message","original":{"line":192,"column":10},"generated":{"line":1,"column":1698}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"message","original":{"line":192,"column":10},"generated":{"line":1,"column":1704}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"Message","original":{"line":192,"column":20},"generated":{"line":1,"column":1706}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"parse","original":{"line":192,"column":28},"generated":{"line":1,"column":1708}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"event","original":{"line":192,"column":34},"generated":{"line":1,"column":1714}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"data","original":{"line":192,"column":40},"generated":{"line":1,"column":1716}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"message","original":{"line":194,"column":9},"generated":{"line":1,"column":1722}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":197,"column":42},"generated":{"line":1,"column":1726}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":197,"column":8},"generated":{"line":1,"column":1730}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"listenerCount","original":{"line":197,"column":13},"generated":{"line":1,"column":1735}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":197,"column":27},"generated":{"line":1,"column":1749}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":206,"column":9},"generated":{"line":1,"column":1760}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"safeEmit","original":{"line":206,"column":9},"generated":{"line":1,"column":1765}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":206,"column":18},"generated":{"line":1,"column":1774}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"message","original":{"line":206,"column":29},"generated":{"line":1,"column":1784}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"logger","original":{"line":199,"column":5},"generated":{"line":1,"column":1787}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"error","original":{"line":199,"column":12},"generated":{"line":1,"column":1789}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","original":{"line":200,"column":6},"generated":{"line":1,"column":1795}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"module","original":{"line":212,"column":0},"generated":{"line":1,"column":1875}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"exports","original":{"line":212,"column":7},"generated":{"line":1,"column":1882}},{"source":"node_modules/protoo-client/lib/transports/WebSocketTransport.js","name":"WebSocketTransport","original":{"line":212,"column":17},"generated":{"line":1,"column":1890}}],"sources":{"node_modules/protoo-client/lib/transports/WebSocketTransport.js":"const W3CWebSocket = require('websocket').w3cwebsocket;\nconst retry = require('retry');\nconst Logger = require('../Logger');\nconst EnhancedEventEmitter = require('../EnhancedEventEmitter');\nconst Message = require('../Message');\n\nconst WS_SUBPROTOCOL = 'protoo';\nconst DEFAULT_RETRY_OPTIONS =\n{\n\tretries    : 10,\n\tfactor     : 2,\n\tminTimeout : 1 * 1000,\n\tmaxTimeout : 8 * 1000\n};\n\nconst logger = new Logger('WebSocketTransport');\n\nclass WebSocketTransport extends EnhancedEventEmitter\n{\n\t/**\n\t * @param {String} url - WebSocket URL.\n\t * @param {Object} [options] - Options for WebSocket-Node.W3CWebSocket and retry.\n\t */\n\tconstructor(url, options)\n\t{\n\t\tsuper(logger);\n\n\t\tlogger.debug('constructor() [url:%s, options:%o]', url, options);\n\n\t\t// Closed flag.\n\t\t// @type {Boolean}\n\t\tthis._closed = false;\n\n\t\t// WebSocket URL.\n\t\t// @type {String}\n\t\tthis._url = url;\n\n\t\t// Options.\n\t\t// @type {Object}\n\t\tthis._options = options || {};\n\n\t\t// WebSocket instance.\n\t\t// @type {WebSocket}\n\t\tthis._ws = null;\n\n\t\t// Run the WebSocket.\n\t\tthis._runWebSocket();\n\t}\n\n\tget closed()\n\t{\n\t\treturn this._closed;\n\t}\n\n\tclose()\n\t{\n\t\tif (this._closed)\n\t\t\treturn;\n\n\t\tlogger.debug('close()');\n\n\t\t// Don't wait for the WebSocket 'close' event, do it now.\n\t\tthis._closed = true;\n\t\tthis.safeEmit('close');\n\n\t\ttry\n\t\t{\n\t\t\tthis._ws.onopen = null;\n\t\t\tthis._ws.onclose = null;\n\t\t\tthis._ws.onerror = null;\n\t\t\tthis._ws.onmessage = null;\n\t\t\tthis._ws.close();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tlogger.error('close() | error closing the WebSocket: %o', error);\n\t\t}\n\t}\n\n\tasync send(message)\n\t{\n\t\tif (this._closed)\n\t\t\tthrow new Error('transport closed');\n\n\t\ttry\n\t\t{\n\t\t\tthis._ws.send(JSON.stringify(message));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tlogger.warn('send() failed:%o', error);\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t_runWebSocket()\n\t{\n\t\tconst operation =\n\t\t\tretry.operation(this._options.retry || DEFAULT_RETRY_OPTIONS);\n\n\t\tlet wasConnected = false;\n\n\t\toperation.attempt((currentAttempt) =>\n\t\t{\n\t\t\tif (this._closed)\n\t\t\t{\n\t\t\t\toperation.stop();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.debug('_runWebSocket() [currentAttempt:%s]', currentAttempt);\n\n\t\t\tthis._ws = new W3CWebSocket(\n\t\t\t\tthis._url,\n\t\t\t\tWS_SUBPROTOCOL,\n\t\t\t\tthis._options.origin,\n\t\t\t\tthis._options.headers,\n\t\t\t\tthis._options.requestOptions,\n\t\t\t\tthis._options.clientConfig);\n\n\t\t\tthis._ws.onopen = () =>\n\t\t\t{\n\t\t\t\tif (this._closed)\n\t\t\t\t\treturn;\n\n\t\t\t\twasConnected = true;\n\n\t\t\t\t// Emit 'open' event.\n\t\t\t\tthis.safeEmit('open');\n\t\t\t};\n\n\t\t\tthis._ws.onclose = (event) =>\n\t\t\t{\n\t\t\t\tif (this._closed)\n\t\t\t\t\treturn;\n\n\t\t\t\tlogger.warn(\n\t\t\t\t\t'WebSocket \"close\" event [wasClean:%s, code:%s, reason:\"%s\"]',\n\t\t\t\t\tevent.wasClean, event.code, event.reason);\n\n\t\t\t\t// Don't retry if code is 4000 (closed by the server).\n\t\t\t\tif (event.code !== 4000)\n\t\t\t\t{\n\t\t\t\t\t// If it was not connected, try again.\n\t\t\t\t\tif (!wasConnected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.safeEmit('failed', currentAttempt);\n\n\t\t\t\t\t\tif (this._closed)\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tif (operation.retry(true))\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// If it was connected, start from scratch.\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\toperation.stop();\n\n\t\t\t\t\t\tthis.safeEmit('disconnected');\n\n\t\t\t\t\t\tif (this._closed)\n\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\tthis._runWebSocket();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._closed = true;\n\n\t\t\t\t// Emit 'close' event.\n\t\t\t\tthis.safeEmit('close');\n\t\t\t};\n\n\t\t\tthis._ws.onerror = () =>\n\t\t\t{\n\t\t\t\tif (this._closed)\n\t\t\t\t\treturn;\n\n\t\t\t\tlogger.error('WebSocket \"error\" event');\n\t\t\t};\n\n\t\t\tthis._ws.onmessage = (event) =>\n\t\t\t{\n\t\t\t\tif (this._closed)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst message = Message.parse(event.data);\n\n\t\t\t\tif (!message)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (this.listenerCount('message') === 0)\n\t\t\t\t{\n\t\t\t\t\tlogger.error(\n\t\t\t\t\t\t'no listeners for WebSocket \"message\" event, ignoring received message');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Emit 'message' event.\n\t\t\t\tthis.safeEmit('message', message);\n\t\t\t};\n\t\t});\n\t}\n}\n\nmodule.exports = WebSocketTransport;\n"},"lineCount":null}},"error":null,"hash":"2cf80a6b3cb762d3d4c2027141ab2549","cacheData":{"env":{}}}